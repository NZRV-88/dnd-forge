import { RequestHandler } from "express";

interface NameGeneratorRequest {
    race?: string;
    class?: string;
    gender?: "male" | "female" | "any";
    count?: number;
}

interface NameGeneratorResponse {
    names: string[];
    success: boolean;
    error?: string;
}

// Базы данных слогов для каждой расы
const RACE_SYLLABLES = {
    elf: {
        prefixes: ["Al", "El", "Il", "Ar", "Er", "Ir", "Or", "Ur", "Ae", "Ea", "Ia", "Oa", "Ua"],
        middles: ["ar", "el", "il", "or", "ur", "an", "en", "in", "on", "un", "al", "ol", "ul", "am", "em", "im", "om", "um"],
        suffixes: ["ion", "iel", "ael", "riel", "driel", "thiel", "viel", "niel", "riel", "siel", "tiel", "wiel", "xiel", "yiel", "ziel"],
        femaleSuffixes: ["a", "ia", "ea", "ara", "ela", "ila", "ora", "ura", "ana", "ena", "ina", "ona", "una"],
        maleSuffixes: ["on", "ion", "eon", "an", "en", "in", "on", "un", "ar", "er", "ir", "or", "ur"]
    },
    human: {
        prefixes: ["Al", "An", "Ar", "Br", "Ch", "Da", "Ed", "Fr", "Ga", "Ha", "Ja", "Ka", "La", "Ma", "Na", "Pa", "Ra", "Sa", "Ta", "Va", "Wa", "Za"],
        middles: ["an", "ar", "el", "er", "in", "on", "or", "un", "al", "ol", "ul", "am", "em", "im", "om", "um", "ad", "ed", "id", "od", "ud"],
        suffixes: ["us", "an", "en", "in", "on", "un", "ar", "er", "ir", "or", "ur", "al", "el", "il", "ol", "ul"],
        femaleSuffixes: ["a", "ia", "ea", "ana", "ena", "ina", "ona", "una", "ara", "era", "ira", "ora", "ura"],
        maleSuffixes: ["us", "an", "en", "in", "on", "un", "ar", "er", "ir", "or", "ur", "al", "el", "il", "ol", "ul"]
    },
    dwarf: {
        prefixes: ["Th", "Br", "Dr", "Gr", "Kr", "Tr", "Vr", "Zr", "B", "D", "G", "K", "T", "V", "Z", "Tho", "Bro", "Dro", "Gro", "Kro", "Tro"],
        middles: ["or", "ar", "er", "ir", "ur", "an", "en", "in", "on", "un", "al", "el", "il", "ol", "ul", "am", "em", "im", "om", "um"],
        suffixes: ["in", "an", "en", "on", "un", "ar", "er", "ir", "or", "ur", "al", "el", "il", "ol", "ul", "ak", "ek", "ik", "ok", "uk"],
        femaleSuffixes: ["a", "ia", "ea", "ara", "era", "ira", "ora", "ura", "ana", "ena", "ina", "ona", "una"],
        maleSuffixes: ["in", "an", "en", "on", "un", "ar", "er", "ir", "or", "ur", "al", "el", "il", "ol", "ul", "ak", "ek", "ik", "ok", "uk"]
    },
    halfling: {
        prefixes: ["Bi", "Bo", "Bu", "Fi", "Fo", "Fu", "Gi", "Go", "Gu", "Hi", "Ho", "Hu", "Ji", "Jo", "Ju", "Ki", "Ko", "Ku", "Li", "Lo", "Lu", "Mi", "Mo", "Mu", "Ni", "No", "Nu", "Pi", "Po", "Pu", "Ri", "Ro", "Ru", "Si", "So", "Su", "Ti", "To", "Tu", "Vi", "Vo", "Vu", "Wi", "Wo", "Wu", "Zi", "Zo", "Zu"],
        middles: ["i", "o", "u", "a", "e", "an", "en", "in", "on", "un", "al", "el", "il", "ol", "ul", "am", "em", "im", "om", "um"],
        suffixes: ["o", "u", "a", "e", "an", "en", "in", "on", "un", "al", "el", "il", "ol", "ul", "ak", "ek", "ik", "ok", "uk"],
        femaleSuffixes: ["a", "ia", "ea", "ara", "era", "ira", "ora", "ura", "ana", "ena", "ina", "ona", "una"],
        maleSuffixes: ["o", "u", "an", "en", "in", "on", "un", "ar", "er", "ir", "or", "ur", "al", "el", "il", "ol", "ul"]
    },
    dragonborn: {
        prefixes: ["Dra", "Kra", "Vra", "Zra", "Bra", "Gra", "Thra", "Sra", "Tra", "Wra", "Xra", "Yra", "Zra", "Aza", "Eza", "Iza", "Oza", "Uza"],
        middles: ["ar", "er", "ir", "or", "ur", "an", "en", "in", "on", "un", "al", "el", "il", "ol", "ul", "am", "em", "im", "om", "um"],
        suffixes: ["th", "k", "g", "r", "n", "m", "l", "s", "t", "v", "z", "x", "y", "ak", "ek", "ik", "ok", "uk", "ar", "er", "ir", "or", "ur"],
        femaleSuffixes: ["a", "ia", "ea", "ara", "era", "ira", "ora", "ura", "ana", "ena", "ina", "ona", "una"],
        maleSuffixes: ["th", "k", "g", "r", "n", "m", "l", "s", "t", "v", "z", "x", "y", "ak", "ek", "ik", "ok", "uk", "ar", "er", "ir", "or", "ur"]
    },
    tiefling: {
        prefixes: ["As", "Az", "Ba", "Be", "Bi", "Bo", "Bu", "Ca", "Ce", "Ci", "Co", "Cu", "Da", "De", "Di", "Do", "Du", "Fa", "Fe", "Fi", "Fo", "Fu", "Ga", "Ge", "Gi", "Go", "Gu", "Ha", "He", "Hi", "Ho", "Hu", "Ja", "Je", "Ji", "Jo", "Ju", "Ka", "Ke", "Ki", "Ko", "Ku", "La", "Le", "Li", "Lo", "Lu", "Ma", "Me", "Mi", "Mo", "Mu", "Na", "Ne", "Ni", "No", "Nu", "Pa", "Pe", "Pi", "Po", "Pu", "Ra", "Re", "Ri", "Ro", "Ru", "Sa", "Se", "Si", "So", "Su", "Ta", "Te", "Ti", "To", "Tu", "Va", "Ve", "Vi", "Vo", "Vu", "Wa", "We", "Wi", "Wo", "Wu", "Xa", "Xe", "Xi", "Xo", "Xu", "Ya", "Ye", "Yi", "Yo", "Yu", "Za", "Ze", "Zi", "Zo", "Zu"],
        middles: ["a", "e", "i", "o", "u", "an", "en", "in", "on", "un", "al", "el", "il", "ol", "ul", "am", "em", "im", "om", "um"],
        suffixes: ["us", "an", "en", "in", "on", "un", "ar", "er", "ir", "or", "ur", "al", "el", "il", "ol", "ul", "ak", "ek", "ik", "ok", "uk"],
        femaleSuffixes: ["a", "ia", "ea", "ara", "era", "ira", "ora", "ura", "ana", "ena", "ina", "ona", "una"],
        maleSuffixes: ["us", "an", "en", "in", "on", "un", "ar", "er", "ir", "or", "ur", "al", "el", "il", "ol", "ul", "ak", "ek", "ik", "ok", "uk"]
    }
};

// Аутентичные эльфийские корни и значения (на основе реальных эльфийских языков)
const ELVEN_ROOTS = {
    // Свет и звезды
    light: {
        prefixes: ["Сил", "Гил", "Эл", "Ал", "Ил", "Ол", "Ул", "Ал", "Эл", "Ил"],
        roots: ["ан", "ар", "ас", "ат", "ав", "аг", "ад", "ак", "ал", "ам", "ан", "ар", "ас", "ат", "ав"],
        suffixes: ["ион", "иэль", "иль", "ион", "иэль", "иль", "ион", "иэль", "иль", "ион"]
    },
    // Природные элементы
    nature: {
        prefixes: ["Аэл", "Ал", "Эл", "Ил", "Ол", "Ул", "Ал", "Эл", "Ил", "Ол"],
        roots: ["ан", "ар", "ас", "ат", "ав", "аг", "ад", "ак", "ал", "ам", "ан", "ар", "ас", "ат", "ав"],
        suffixes: ["ион", "иэль", "иль", "ион", "иэль", "иль", "ион", "иэль", "иль", "ион"]
    },
    // Вода и море
    water: {
        prefixes: ["Аэл", "Ал", "Эл", "Ил", "Ол", "Ул", "Ал", "Эл", "Ил", "Ол"],
        roots: ["ан", "ар", "ас", "ат", "ав", "аг", "ад", "ак", "ал", "ам", "ан", "ар", "ас", "ат", "ав"],
        suffixes: ["ион", "иэль", "иль", "ион", "иэль", "иль", "ион", "иэль", "иль", "ион"]
    },
    // Лес и деревья
    forest: {
        prefixes: ["Тау", "Лау", "Нау", "Рау", "Сау", "Вау", "Зау", "Кау", "Мау", "Пау"],
        roots: ["ри", "ли", "ни", "ри", "ли", "ни", "ри", "ли", "ни", "ри"],
        suffixes: ["иэль", "ион", "иль", "иэль", "ион", "иль", "иэль", "ион", "иль", "иэль"]
    }
};

// Аутентичные эльфийские фамилии с значениями
const ELVEN_SURNAMES = {
    // Световые фамилии
    light: [
        "Имяфель", "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль",
        "Сильванаэ", "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил",
        "Истельдарин", "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль"
    ],
    // Природные фамилии
    nature: [
        "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль", "Сильванаэ",
        "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил", "Истельдарин",
        "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль", "Лаэнор"
    ],
    // Водные фамилии
    water: [
        "Имяфель", "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль",
        "Сильванаэ", "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил",
        "Истельдарин", "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль"
    ],
    // Лесные фамилии
    forest: [
        "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль", "Сильванаэ",
        "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил", "Истельдарин",
        "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль", "Лаэнор"
    ]
};

// Богатая база данных аутентичных эльфийских имен (50+ уникальных вариантов)
const AUTHENTIC_ELVEN_NAMES = {
    male: [
        "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан",
        "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин",
        "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил", "Силарион", "Тауриэль", "Финдолас",
        "Элронд", "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег",
        "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль",
        "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан",
        "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин"
    ],
    female: [
        "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль",
        "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил",
        "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан", "Лиастра",
        "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль",
        "Сандорион", "Эланор", "Юваниэль", "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд",
        "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль",
        "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил"
    ]
};

// Богатая база данных аутентичных эльфийских фамилий (50+ вариантов)
const AUTHENTIC_ELVEN_SURNAMES = [
    "Имяфель", "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль",
    "Сильванаэ", "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил",
    "Истельдарин", "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль",
    "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль", "Сильванаэ",
    "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил", "Истельдарин",
    "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль", "Лаэнор",
    "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль", "Сильванаэ", "Эленвиэ"
];

// Базы данных фэнтезийных имен в кириллице
const CYRILLIC_FANTASY_NAMES = {
    elf: {
        male: [
            "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан",
            "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин",
            "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил", "Силарион", "Тауриэль", "Финдолас",
            "Элронд", "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег",
            "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль"
        ],
        female: [
            "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль",
            "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил",
            "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан", "Лиастра",
            "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль",
            "Сандорион", "Эланор", "Юваниэль", "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд"
        ]
    },
    dwarf: {
        male: [
            "Торбин", "Громдар", "Балин", "Дурин", "Фаргрим", "Орик", "Хагар", "Каздар", "Моргрин", "Бордин",
            "Торгар", "Даин", "Гундар", "Флинт", "Скард", "Гимли", "Балин", "Двалин", "Нали", "Орин",
            "Лони", "Флои", "Эйрик", "Хаки", "Глордин", "Краги", "Мотри", "Солви", "Хогни", "Вольстен",
            "Эрланд", "Сигурд", "Йорунн", "Рагнхильд", "Ульфгар", "Торбин", "Громдар", "Балин", "Дурин", "Фаргрим",
            "Орик", "Хагар", "Каздар", "Моргрин", "Бордин", "Торгар", "Даин", "Гундар", "Флинт", "Скард"
        ],
        female: [
            "Хельга", "Ильда", "Брунгильда", "Фрейда", "Диса", "Хильдра", "Герта", "Катрин", "Астрид", "Сигрид",
            "Инге", "Бодрил", "Рангильда", "Гуннхильда", "Тордис", "Хельга", "Ильда", "Брунгильда", "Фрейда", "Диса",
            "Хильдра", "Герта", "Катрин", "Астрид", "Сигрид", "Инге", "Бодрил", "Рангильда", "Гуннхильда", "Тордис",
            "Хельга", "Ильда", "Брунгильда", "Фрейда", "Диса", "Хильдра", "Герта", "Катрин", "Астрид", "Сигрид",
            "Инге", "Бодрил", "Рангильда", "Гуннхильда", "Тордис", "Хельга", "Ильда", "Брунгильда", "Фрейда", "Диса"
        ]
    },
    human: {
        // Англо-саксонские / Средневековые европейские
        angloSaxon: {
            male: ["Элгар", "Осрик", "Торстен", "Леофрик", "Элдор", "Эдвин", "Беорн", "Кенрик", "Вульфрик", "Альдрик"],
            female: ["Хельга", "Виннифер", "Бритта", "Морвен", "Этельфлаед", "Годгифу", "Эльфгифу", "Вульфрун", "Эдита", "Гунхильд"]
        },
        // Континентальные / Барочные
        continental: {
            male: ["Арман", "Лоренц", "Серж", "Годфри", "Рено", "Анри", "Филипп", "Луи", "Пьер", "Жан"],
            female: ["Женевьева", "Изабель", "Катрин", "Одиль", "Клаудиа", "Мари", "Анн", "Клод", "Жанна", "Маргарита"]
        },
        // Славянские / Восточноевропейские
        slavic: {
            male: ["Казимир", "Драган", "Борис", "Станко", "Радослав", "Григор", "Владислав", "Станислав", "Богдан", "Ярослав"],
            female: ["Ярослава", "Зорина", "Милена", "Верица", "Катарина", "Анастасия", "Елена", "Мария", "Ольга", "Татьяна"]
        },
        // Южные / Средиземноморские
        mediterranean: {
            male: ["Алессандро", "Диего", "Лоренцо", "Рафаэль", "Мариус", "Антонио", "Джузеппе", "Франческо", "Марко", "Андреа"],
            female: ["Изабелла", "София", "Валентина", "Кассандра", "Элоиза", "Мария", "Анна", "Джулия", "Франческа", "Клаудия"]
        },
        // Экзотические / Смешанные
        exotic: {
            male: ["Тариан", "Зэйн", "Оррин", "Корван", "Фенрис", "Ансельм", "Даррен", "Кайден", "Зейн", "Орион"],
            female: ["Кайра", "Серена", "Лиана", "Джинн", "Ариэль", "Луна", "Стелла", "Нова", "Зара", "Миа"]
        }
    },
    halfling: {
        male: [
            "Теодред", "Фоссо", "Бинго", "Сэмло", "Марло", "Андер", "Гормо", "Тротер", "Фолко", "Дрого",
            "Бэрримен", "Гринбэк", "Хэвлок", "Гудчер", "Стоунфилд", "Ривербэнк", "Тандерс", "Хиллто", "Андерхилл", "Тук",
            "Вебстер", "Купер", "Флетчер", "Миллер", "Тэйлор", "Потер", "Смит", "Картер", "Мэйсон", "Фишер",
            "Брамбл", "Чизвик", "Берри", "Хонисуэлл", "Пламб", "Грейндж", "Эплби", "Хоппер", "Бейкер", "Гарденер",
            "Теодред", "Фоссо", "Бинго", "Сэмло", "Марло", "Андер", "Гормо", "Тротер", "Фолко", "Дрого"
        ],
        female: [
            "Примроуз", "Лавиния", "Эсмеральда", "Пенни", "Руби", "Поппи", "Дейзи", "Люси", "Марго", "Эшли",
            "Бэрримен", "Гринбэк", "Хэвлок", "Гудчер", "Стоунфилд", "Ривербэнк", "Тандерс", "Хиллто", "Андерхилл", "Тук",
            "Вебстер", "Купер", "Флетчер", "Миллер", "Тэйлор", "Потер", "Смит", "Картер", "Мэйсон", "Фишер",
            "Брамбл", "Чизвик", "Берри", "Хонисуэлл", "Пламб", "Грейндж", "Эплби", "Хоппер", "Бейкер", "Гарденер",
            "Примроуз", "Лавиния", "Эсмеральда", "Пенни", "Руби", "Поппи", "Дейзи", "Люси", "Марго", "Эшли"
        ]
    },
    dragonborn: {
        male: [
            "Арджек", "Криксус", "Торгар", "Ворлаг", "Зорг", "Гразз", "Драккар", "Скар", "Бартекс", "Хискар",
            "Ксерик", "Накс", "Орок", "Зерт", "Галак", "Фенро", "Йорг", "Крион", "Талос", "Ворун",
            "Орей", "Феррум", "Аргент", "Аурум", "Купрум", "Платина", "Стил", "Кобальт", "Вольфрам", "Оловус",
            "Рекс", "Империум", "Магнус", "Нобилис", "Вулкатус", "Инвиктус", "Арджек", "Криксус", "Торгар", "Ворлаг",
            "Зорг", "Гразз", "Драккар", "Скар", "Бартекс", "Хискар", "Ксерик", "Накс", "Орок", "Зерт"
        ],
        female: [
            "Вексия", "Игнисса", "Зара", "Тиамат", "Систра", "Ракса", "Мириль", "Ксифия", "Ноктура", "Вулкана",
            "Регия", "Прима", "Валирия", "Вексия", "Игнисса", "Зара", "Тиамат", "Систра", "Ракса", "Мириль",
            "Ксифия", "Ноктура", "Вулкана", "Регия", "Прима", "Валирия", "Вексия", "Игнисса", "Зара", "Тиамат",
            "Систра", "Ракса", "Мириль", "Ксифия", "Ноктура", "Вулкана", "Регия", "Прима", "Валирия", "Вексия",
            "Игнисса", "Зара", "Тиамат", "Систра", "Ракса", "Мириль", "Ксифия", "Ноктура", "Вулкана", "Регия"
        ]
    },
    tiefling: {
        male: [
            "Зэриэль", "Каинус", "Разиэль", "Веспасиан", "Люцифер", "Санаэль", "Дамарион", "Малфарий",
            "Серафин", "Зартос", "Амон", "Лерадж", "Нергал", "Эребос", "Мефисто", "Баал", "Астарот",
            "Данталион", "Фенрик", "Зепар", "Элион", "Каэлан", "Люциан", "Ориан", "Сильван", "Кассиан",
            "Соланж", "Ремус", "Феликс", "Клеменс", "Веру", "Спес", "КарИТас", "Пациенция", "Зэриэль",
            "Каинус", "Разиэль", "Веспасиан", "Люцифер", "Санаэль", "Дамарион", "Малфарий", "Серафин",
            "Зартос", "Амон", "Лерадж", "Нергал", "Эребос", "Мефисто", "Баал", "Астарот", "Данталион"
        ],
        female: [
            "Моргана", "Лилит", "Хеката", "Немея", "Калиста", "Исперия", "Белладонна", "Ноктюрна",
            "Серафина", "Валерия", "Илария", "Эола", "Изольда", "Аурелия", "Глория", "Пруденс", "Моргана",
            "Лилит", "Хеката", "Немея", "Калиста", "Исперия", "Белладонна", "Ноктюрна", "Серафина",
            "Валерия", "Илария", "Эола", "Изольда", "Аурелия", "Глория", "Пруденс", "Моргана", "Лилит",
            "Хеката", "Немея", "Калиста", "Исперия", "Белладонна", "Ноктюрна", "Серафина", "Валерия",
            "Илария", "Эола", "Изольда", "Аурелия", "Глория", "Пруденс", "Моргана", "Лилит", "Хеката"
        ]
    },
    gnome: {
        male: [
            "Элдорин", "Филиппер", "Глимвик", "Тимби", "Зуки", "Кипни", "Бодкин", "Стерли", "Флин", "Пибл",
            "Вондер", "Глим", "Зиззл", "Тинкер", "Физзл", "Спарк", "Гир", "Ког", "Глиммер", "Джинкл",
            "Брилл", "Эмбер", "Джаспер", "Руби", "Топаз", "Силк", "Перри", "Рози", "Баддл", "Седжи",
            "Элдорин", "Филиппер", "Глимвик", "Тимби", "Зуки", "Кипни", "Бодкин", "Стерли", "Флин", "Пибл",
            "Вондер", "Глим", "Зиззл", "Тинкер", "Физзл", "Спарк", "Гир", "Ког", "Глиммер", "Джинкл"
        ],
        female: [
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили",
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили",
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили",
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили",
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили"
        ]
    },
    'half-orc': {
        male: [
            "Гарз", "Дарг", "Мог", "Шарк", "Хагрук", "Брог", "Горб", "Луг", "Снарл", "Ульф",
            "Разгар", "Гордум", "Зулган", "Дроггар", "Скарн", "Рагнар", "Корг", "Гнарр", "Снук", "Фенгар",
            "Дрол", "Гнолл", "Зорг", "Ворг", "Грим", "Хрош", "Борг", "Драк", "Грош", "Морг",
            "Зандар", "Крагг", "Торг", "Фанг", "Скарг", "Гарз", "Дарг", "Мог", "Шарк", "Хагрук",
            "Брог", "Горб", "Луг", "Снарл", "Ульф", "Разгар", "Гордум", "Зулган", "Дроггар", "Скарн"
        ],
        female: [
            "Шарка", "Барга", "Граба", "Мурга", "Ягга", "Хельда", "Ворга", "Зулла", "Гриза", "Урза",
            "Скалла", "Драга", "Морга", "Хурза", "Брогга", "Гарза", "Дарга", "Мога", "Шарка", "Хагрука",
            "Брога", "Горба", "Луга", "Снарла", "Ульфа", "Разгара", "Гордума", "Зулгана", "Дроггара", "Скарна",
            "Рагнара", "Корга", "Гнарра", "Снука", "Фенгара", "Дрола", "Гнолла", "Зорга", "Ворга", "Грима",
            "Хроша", "Борга", "Драка", "Гроша", "Морга", "Зандара", "Крагга", "Торга", "Фанга", "Скарга"
        ]
    }
};

// Богатые фэнтезийные фамилии в кириллице
const CYRILLIC_FANTASY_SURNAMES = {
    // Эльфийские фамилии (50+ вариантов)
    elf: [
        "Солнцеликий", "Луносвет", "Ветрогул", "Звездопад"
    ],
    // Дварфские фамилии (50+ вариантов) - аутентичные дварфские клановые имена
    dwarf: [
        "Казангар", "Торрук", "Грундир", "Хартмунд", "Бардок", "Галлмар", "Стренгар", "Фельдрин",
        "Бролен", "Гортак", "Дромар", "Крагнар", "Торвал", "Хардрен", "Ульфгар", "Стенвар",
        "Фьолнар", "Хогнар", "Бруни", "Гейрмунд", "Кетиль", "Эйольф", "Халльдор", "Веланд",
        "Регин", "Трасти", "Гизур", "Ормгард", "Ивар", "Эйнар", "Альвар", "Бьорн",
        "Лейф", "Хердис", "Сверрир", "Казангар", "Торрук", "Грундир", "Хартмунд", "Бардок",
        "Галлмар", "Стренгар", "Фельдрин", "Бролен", "Гортак", "Дромар", "Крагнар", "Торвал",
        "Хардрен", "Ульфгар", "Стенвар", "Фьолнар", "Хогнар", "Бруни", "Гейрмунд", "Кетиль",
        "Эйольф", "Халльдор", "Веланд", "Регин", "Трасти", "Гизур", "Ормгард", "Ивар"
    ],
    // Человеческие фамилии (50+ вариантов)
    human: {
        // Англо-саксонские / Средневековые европейские
        angloSaxon: [
            "Греймэн", "Стоунфист", "Айронсулд", "Хэммэрфол", "Гудбэрроу", "Фэрвуд", "Риверс", "Хэвлок",
            "Блэквуд", "Хоукридж", "Стоунбридж", "Айронвуд", "Голдфилд", "Силвертон", "Бронзхолл", "Копперфилд",
            "Вудбридж", "Ривертон", "Хиллкрест", "Вэлливью", "Форестхолл", "Мурленд", "Хэтхолл", "Гринфилд"
        ],
        // Континентальные / Барочные
        continental: [
            "Дюлак", "де Вейн", "Монтегю", "Вальдек", "де Роше", "Валлуа", "Лефевр", "фон Кагера",
            "Маршалк", "д'Энтин", "де Бурбон", "фон Габсбург", "де Медичи", "д'Эсте", "фон Гогенцоллерн", "де Валуа",
            "фон Виттельсбах", "д'Альбре", "де Монморанси", "фон Габсбург-Лотаринген", "д'Анжу", "де Бургундия", "фон Саксен-Кобург", "д'Орлеан"
        ],
        // Славянские / Восточноевропейские
        slavic: [
            "Волков", "Зимань", "Огнян", "Ночной Ветер", "Громов", "Врана", "Рудина", "Стальной",
            "Драконова", "Скален", "Медведев", "Орлов", "Соколов", "Воронов", "Белов", "Чернов",
            "Краснов", "Зеленов", "Синеев", "Желтов", "Бежев", "Серов", "Коричнев", "Фиолетов"
        ],
        // Южные / Средиземноморские
        mediterranean: [
            "Коста", "Марино", "де ла Сьерра", "Орсини", "Вискарди", "Эспозито", "Торрес", "Сальваторе",
            "д'Анжер", "Флёр", "Романо", "Бьянки", "Росси", "Феррари", "Руссо", "Мартини", "Конти", "Риччи",
            "Моретти", "Бруно", "Галли", "Ломбарди", "Джордано", "Палермо", "Наполи", "Венеция"
        ],
        // Экзотические / Смешанные
        exotic: [
            "Штормволк", "Зимняя Тень", "Блэквуд", "Скайуокер", "Кэссл", "Мунфолл", "Сол", "Сандсторм",
            "Грей", "Редвин", "Файрстоун", "Айсбрейкер", "Тандерболт", "Фроствинд", "Шэдоуфолл", "Лайтбрингер",
            "Даркривер", "Старфолл", "Мунрайз", "Сансет", "Доунбрейкер", "Найтфолл", "Дейбрейкер", "Твайлайт"
        ]
    },
    // Халфлингские фамилии (50+ вариантов)
    halfling: [
        "Ячменовар", "Травопут", "Лукошко", "Корнеплод", "Пчелоносец", "Теплиц", "Дымокур", "Ручьевой",
        "Овинник", "Лежнеплод", "Рябинник", "Грибоедова", "Верескова", "Пирожкова", "Запеканка", "Солноверт",
        "Лукошечка", "Пряничина", "Лесопадова", "Рукавички", "Подкустов", "Пригоршня", "Запечный", "Перекати",
        "Межгор", "Лежебок", "Самоваров", "Покосив", "Кочедыжкин", "Завалинка", "Ткацкин", "Бондаренко",
        "Степловой", "Мельников", "Швейкин", "Горшочников", "Кузнецов", "Тележкин", "Каменщиков", "Рыбалов",
        "Ежевикин", "Сыроваров", "Ягоднов", "Медоваров", "Сливовкин", "Житнов", "Яблонов", "Хмелев",
        "Пирогов", "Огородов", "Ячменовар", "Травопут", "Лукошко", "Корнеплод", "Пчелоносец", "Теплиц"
    ],
    // Драконорожденные фамилии (50+ вариантов)
    dragonborn: [
        "Ворвидаггар", "Зилвиндор", "Игниварн", "Скорфист", "Малакор", "Гхондраксис", "Вултрон", "Оротрикс",
        "Фирнакс", "Зеритракс", "Ауридракс", "Пиррония", "Ксилотрикса", "Ноксарра", "Гласиос", "Электра",
        "Азрания", "Хидросса", "Умбракс", "Магмора", "Вердингар", "Терроксис", "Бриндаксий", "Ксилоник",
        "Цироний", "Корвидиан", "Стиджир", "Хеймраз", "Сандрекс", "Ашкар", "Хромакс", "Адамантис",
        "Митриллор", "Орхалкон", "Бронзорий", "Нидерим", "Вулдракс", "Азурион", "Тантарис", "Свингар",
        "Драконис", "Скайлор", "Доминаар", "Тиранус", "Империал", "Регалис", "Игнифер", "Виктрикс",
        "Стратос", "Аэтернис", "Ворвидаггар", "Зилвиндор", "Игниварн", "Скорфист", "Малакор", "Гхондраксис"
    ],
    // Тайфлинги (50+ вариантов)
    tiefling: [
        "Азракан", "Малфектар", "Ноктурнус", "Инфернус", "Тенебрис", "Умбрус", "Скортис", "Игнис",
        "Ксапракс", "Вулкракс", "Ноксия", "Круор", "Стигийя", "Сарказия", "Пирогения", "Фурия",
        "Виперра", "Обливия", "Ксеркселия", "Деспера", "Керзос", "Зитиос", "Таксис", "Зофос",
        "Фаустус", "Зебулон", "Каркарон", "Мнемос", "Стикс", "Ахерон", "Вандир", "Морденси",
        "Триксиан", "Сиренна", "Фаллакс", "Долоса", "Мендакс", "Фебрис", "Венефикум", "Фалласи",
        "Амаранта", "Инвиктус", "Виктория", "Фатум", "Анима", "Ментис", "Фидес", "Сальюс",
        "Амор", "ЛенИс", "Азракан", "Малфектар", "Ноктурнус", "Инфернус", "Тенебрис", "Умбрус"
    ],
    // Гномьи фамилии (50+ вариантов) - аутентичные гномьи фамилии
    gnome: [
        "Зербиндл", "Гаджетофус", "Спригглбут", "Наклглиммер", "Спарклендер", "Гирвистл", "Тинкербелл", "Вондершпиндель",
        "Когворт", "Фюззиджет", "Спиннель", "Глиммершпин", "Джуэлфлип", "Гаджетвистл", "Спригглспрокет", "Арканеген",
        "Твистлешпин", "Виджит", "Когворт", "Спарклфлай", "Гимер", "Сприггл", "Гаджет", "Накл",
        "Виджет", "Твистл", "Спиннер", "Флай", "Шпиндель", "Болт", "Стоунспин", "Риверглим",
        "Фернтриггер", "Спрингшпин", "Ливендер", "Брукбендер", "Пондлглиммер", "Хопперфлип", "Грассприг", "Ридлвистл",
        "Искрящийся механизм", "Хитроумное устройство", "Пружинящий сапог", "Блестящая заклёпка", "Дающий искры", "Свистящая шестерня", "Колокольчик мастера", "Чудесное веретено",
        "Достойный шестерни", "Нечёткий механизм", "Вертящаяся", "Блестящее вращение", "Ювелирный щелчок", "Свист механизма", "Шестерёнка с завитками", "Таинственный рычаг",
        "Вихревое вращение", "Живой механизм", "Достойная шестерни", "Искрящаяся муха", "Шестерёнка", "Завиток", "Приспособление", "Соединение",
        "Устройство", "Вихрь", "Пряха", "Полёт", "Веретено", "Болт", "Каменное вращение", "Речной блеск"
    ],
    // Полуорки (50+ вариантов) - аутентичные орочьи фамилии
    'half-orc': [
        "Гро'туш", "Зуг'гаш", "Тар'кан", "Гхор'дак", "Дуг'рул", "Крул'нах", "Шарк'зан", "Гом'раш",
        "Дак'фанг", "Нар'гул", "Скор'так", "Бур'дак", "Гхор'зул", "Мар'ток", "Гул'дан", "Гром'Рог",
        "Гро'туш", "Зуг'гаш", "Тар'кан", "Гхор'дак", "Дуг'рул", "Крул'нах", "Шарк'зан", "Гом'раш",
        "Дак'фанг", "Нар'гул", "Скор'так", "Бур'дак", "Гхор'зул", "Мар'ток", "Гул'дан", "Гром'Рог",
        "Гро'туш", "Зуг'гаш", "Тар'кан", "Гхор'дак", "Дуг'рул", "Крул'нах", "Шарк'зан", "Гом'раш",
        "Дак'фанг", "Нар'гул", "Скор'так", "Бур'дак", "Гхор'зул", "Мар'ток", "Гул'дан", "Гром'Рог",
        "Гро'туш", "Зуг'гаш", "Тар'кан", "Гхор'дак", "Дуг'рул", "Крул'нах", "Шарк'зан", "Гом'раш"
    ]
};

export const handleAdvancedNameGenerator: RequestHandler = async (req, res) => {
    try {
        const { race, class: characterClass, gender = "any", count = 1 }: NameGeneratorRequest = req.body;
        

        const names: string[] = [];

        for (let i = 0; i < count; i++) {
            const name = generateCyrillicFantasyName(race, characterClass, gender);
            names.push(name);
        }

        const response: NameGeneratorResponse = {
            names,
            success: true
        };

        res.json(response);

    } catch (error) {
        console.error('Advanced name generation error:', error);
        
        const response: NameGeneratorResponse = {
            names: [],
            success: false,
            error: error instanceof Error ? error.message : 'Unknown error'
        };
        
        res.json(response);
    }
};

function generateNameFromSyllables(syllables: any, gender: string): string {
    const { prefixes, middles, suffixes, femaleSuffixes, maleSuffixes } = syllables;
    
    // Выбираем префикс
    const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
    
    // Выбираем средний слог (50% шанс)
    const hasMiddle = Math.random() > 0.5;
    const middle = hasMiddle ? middles[Math.floor(Math.random() * middles.length)] : '';
    
    // Выбираем суффикс в зависимости от пола
    let suffix: string;
    if (gender === 'female') {
        suffix = femaleSuffixes[Math.floor(Math.random() * femaleSuffixes.length)];
    } else if (gender === 'male') {
        suffix = maleSuffixes[Math.floor(Math.random() * maleSuffixes.length)];
    } else {
        // Случайный пол
        const isFemale = Math.random() > 0.5;
        suffix = isFemale 
            ? femaleSuffixes[Math.floor(Math.random() * femaleSuffixes.length)]
            : maleSuffixes[Math.floor(Math.random() * maleSuffixes.length)];
    }
    
    // Комбинируем слоги
    let name = prefix + middle + suffix;
    
    // Применяем правила для улучшения звучания
    name = applyPhoneticRules(name);
    
    return name;
}

function applyPhoneticRules(name: string): string {
    // Убираем повторяющиеся буквы
    name = name.replace(/(.)\1+/g, '$1');
    
    // Убираем неудобные сочетания
    name = name.replace(/[bcdfghjklmnpqrstvwxyz]{3,}/g, (match) => {
        return match.substring(0, 2);
    });
    
    // Убираем неудобные сочетания гласных
    name = name.replace(/[aeiou]{3,}/g, (match) => {
        return match.substring(0, 2);
    });
    
    // Капитализируем первую букву
    name = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
    
    return name;
}

function generateCyrillicFantasyName(race?: string, characterClass?: string, gender: string = "any"): string {
    // Определяем пол
    let actualGender = gender;
    if (gender === "any") {
        actualGender = Math.random() > 0.5 ? "male" : "female";
    }
    
    // Определяем расу
    const raceKey = race?.toLowerCase() || 'human';
    
    // Для эльфов и полуэльфов используем аутентичную генерацию
    if (raceKey === 'elf' || raceKey === 'half-elf' || raceKey === 'halfelf') {
        return generateAuthenticElvenName(actualGender);
    }
    
    // Для людей используем культурные архетипы
    if (raceKey === 'human') {
        return generateAuthenticHumanName(actualGender);
    }
    
    // Для полуорков используем аутентичные орочьи имена
    if (raceKey === 'half-orc' || raceKey === 'halforc') {
        return generateAuthenticOrcName(actualGender);
    }
    
    // Для дварфов используем аутентичные дварфские имена
    if (raceKey === 'dwarf') {
        return generateAuthenticDwarfName(actualGender);
    }
    
    // Для гномов используем аутентичные гномьи имена
    if (raceKey === 'gnome') {
        return generateAuthenticGnomeName(actualGender);
    }
    
    // Для остальных рас используем старую систему
    const raceNames = CYRILLIC_FANTASY_NAMES[raceKey as keyof typeof CYRILLIC_FANTASY_NAMES];
    
    // Проверяем, есть ли у расы простая структура (не human)
    if (raceNames && 'male' in raceNames && 'female' in raceNames) {
        // Выбираем имя
        const nameList = actualGender === "male" ? raceNames.male : raceNames.female;
        const firstName = nameList[Math.floor(Math.random() * nameList.length)];
        
        // Выбираем фамилию
        const surnameList = CYRILLIC_FANTASY_SURNAMES[raceKey as keyof typeof CYRILLIC_FANTASY_SURNAMES];
        if (Array.isArray(surnameList)) {
            const surname = surnameList[Math.floor(Math.random() * surnameList.length)];
            return `${firstName} ${surname}`;
        }
    }
    
    // Fallback для остальных случаев
    return "Неизвестное Имя";
}

function generateAuthenticHumanName(gender: string): string {
    // Выбираем случайный культурный архетип
    const culturalArchetypes = Object.keys(CYRILLIC_FANTASY_NAMES.human);
    const archetype = culturalArchetypes[Math.floor(Math.random() * culturalArchetypes.length)];
    
    // Получаем имена и фамилии для выбранного архетипа
    const archetypeNames = CYRILLIC_FANTASY_NAMES.human[archetype as keyof typeof CYRILLIC_FANTASY_NAMES.human];
    const archetypeSurnames = CYRILLIC_FANTASY_SURNAMES.human[archetype as keyof typeof CYRILLIC_FANTASY_SURNAMES.human];
    
    // Выбираем имя
    const nameList = gender === "male" ? archetypeNames.male : archetypeNames.female;
    const firstName = nameList[Math.floor(Math.random() * nameList.length)];
    
    // Выбираем фамилию
    const surname = archetypeSurnames[Math.floor(Math.random() * archetypeSurnames.length)];
    
    return `${firstName} ${surname}`;
}

function generateAuthenticOrcName(gender: string): string {
    // Получаем орочьи имена и фамилии
    const orcNames = CYRILLIC_FANTASY_NAMES['half-orc'];
    const orcSurnames = CYRILLIC_FANTASY_SURNAMES['half-orc'];
    
    // Выбираем имя
    const nameList = gender === "male" ? orcNames.male : orcNames.female;
    const firstName = nameList[Math.floor(Math.random() * nameList.length)];
    
    // Выбираем фамилию
    const surname = orcSurnames[Math.floor(Math.random() * orcSurnames.length)];
    
    return `${firstName} ${surname}`;
}

function generateAuthenticDwarfName(gender: string): string {
    // Получаем дварфские имена и фамилии
    const dwarfNames = CYRILLIC_FANTASY_NAMES.dwarf;
    const dwarfSurnames = CYRILLIC_FANTASY_SURNAMES.dwarf;
    
    // Выбираем имя
    const nameList = gender === "male" ? dwarfNames.male : dwarfNames.female;
    const firstName = nameList[Math.floor(Math.random() * nameList.length)];
    
    // Выбираем фамилию
    const surname = dwarfSurnames[Math.floor(Math.random() * dwarfSurnames.length)];
    
    return `${firstName} ${surname}`;
}

function generateAuthenticGnomeName(gender: string): string {
    // Получаем гномьи имена и фамилии
    const gnomeNames = CYRILLIC_FANTASY_NAMES.gnome;
    const gnomeSurnames = CYRILLIC_FANTASY_SURNAMES.gnome;
    
    // Выбираем имя
    const nameList = gender === "male" ? gnomeNames.male : gnomeNames.female;
    const firstName = nameList[Math.floor(Math.random() * nameList.length)];
    
    // Выбираем фамилию
    const surname = gnomeSurnames[Math.floor(Math.random() * gnomeSurnames.length)];
    
    return `${firstName} ${surname}`;
}

function generateAuthenticElvenName(gender: string): string {
    // Выбираем случайную категорию эльфийских корней
    const categories = Object.keys(ELVEN_ROOTS);
    const category = categories[Math.floor(Math.random() * categories.length)];
    const roots = ELVEN_ROOTS[category as keyof typeof ELVEN_ROOTS];
    
    // Генерируем имя из корней
    const prefix = roots.prefixes[Math.floor(Math.random() * roots.prefixes.length)];
    const root = roots.roots[Math.floor(Math.random() * roots.roots.length)];
    const suffix = roots.suffixes[Math.floor(Math.random() * roots.suffixes.length)];
    
    // Адаптируем суффикс для пола
    let finalSuffix = suffix;
    if (gender === "female") {
        // Для женских имен используем более мягкие суффиксы
        if (suffix.endsWith("ион")) {
            finalSuffix = suffix.replace("ион", "иэль");
        } else if (suffix.endsWith("иль")) {
            finalSuffix = suffix.replace("иль", "иэль");
        }
    }
    
    const firstName = `${prefix}${root}${finalSuffix}`;
    
    // Выбираем соответствующую фамилию
    const surnameCategory = category as keyof typeof ELVEN_SURNAMES;
    const surnameList = ELVEN_SURNAMES[surnameCategory];
    const surname = surnameList[Math.floor(Math.random() * surnameList.length)];
    
    return `${firstName} ${surname}`;
}
