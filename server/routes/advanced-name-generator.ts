import { RequestHandler } from "express";

interface NameGeneratorRequest {
    race?: string;
    class?: string;
    gender?: "male" | "female" | "any";
    count?: number;
}

interface NameGeneratorResponse {
    names: string[];
    success: boolean;
    error?: string;
}

// Базы данных слогов для каждой расы
const RACE_SYLLABLES = {
    "elf": {
        // Начальные слоги (корневые основы)
        prefixes: [
            "Ал", "Аэ", "Ан", "Ам", "Ари", "Ара", "Аль", 
            "Эл", "Эа", "Эн", "Эм", "Эри", "Эру", "Эль",
            "Ил", "Иа", "Ин", "Им", "Ири", "Иси", "Иль", 
            "Ол", "Оа", "Он", "Ом", "Ори", "Оро", "Оль",
            "Ул", "Уа", "Ун", "Ум", "Ури", "Уру",
            "Ла", "Ле", "Ли", "Ло", "Лу", "Лю",
            "Ра", "Ре", "Ри", "Ро", "Ру", "Рю",
            "На", "Не", "Ни", "Но", "Ну", "Нэ",
            "Са", "Се", "Си", "Со", "Су", "Сэ",
            "Та", "Те", "Ти", "То", "Ту", "Тэ",
            "Ка", "Ке", "Ки", "Ко", "Ку", "Кэ",
            "Ма", "Ме", "Ми", "Мо", "Му", "Мэ",
            "Ва", "Ве", "Ви", "Во", "Ву", "Вэ"
        ],
        
        // Средние слоги (соединительные)
        middles: [
            "ри", "ли", "ни", "си", "ти", "ви", "ди", "ми", 
            "ла", "ра", "на", "са", "та", "ва", "да", "ма",
            "ль", "рль", "нль", "сль", "тль", "вль", "дль",
            "ан", "эн", "ин", "он", "ун", "ян", "ен",
            "ар", "эр", "ир", "ор", "ур", "яр", "ер",
            "ам", "эм", "им", "ом", "ум", "ям", "ем",
            "ат", "эт", "ит", "от", "ут", "ят", "ет",
            "ас", "эс", "ис", "ос", "ус", "яс", "ес"
        ],
        
        // Общие суффиксы (универсальные)
        suffixes: [
            "ион", "иэль", "аэль", "риэль", "диэль", "тиэль", 
            "виэль", "ниэль", "сиэль", "лиэль", "миэль", "рион",
            "дион", "тион", "вион", "нион", "сион", "лион",
            "анда", "энда", "инда", "онда", "унда", "анна",
            "энна", "инна", "онна", "унна", "арил", "эрил",
            "ирил", "орил", "урил", "арон", "эрон", "ирон",
            "орон", "урон", "арис", "эрис", "ирис", "орис"
        ],
        
        // Женские суффиксы
        femaleSuffixes: [
            "а", "иа", "эа", "иль", "эль", "иль", 
            "ара", "эра", "ира", "ора", "ура", 
            "ана", "эна", "ина", "она", "уна",
            "елла", "илла", "олла", "улла", "алла",
            "енна", "инна", "онна", "унна", "анна",
            "ели", "или", "оли", "ули", "али",
            "естра", "истра", "остра", "устра"
        ],
        
        // Мужские суффиксы  
        maleSuffixes: [
            "он", "ион", "эон", "ан", "эн", "ин", 
            "он", "ун", "ар", "эр", "ир", "ор", 
            "ур", "арон", "эрон", "ирон", "орон",
            "урон", "анор", "энор", "инор", "онор",
            "унор", "атир", "этир", "итир", "отир",
            "утир", "амир", "эмир", "имир", "омир",
            "умир", "адан", "эдан", "идан", "одан"
        ],
        
        // Приставки для благозвучности (опционально)
        starters: [
            "Ай", "Эй", "Ий", "Ой", "Уй", "Ал", "Эл", 
            "Ил", "Ол", "Ул", "Ар", "Эр", "Ир", "Ор", "Ур"
        ],
        
        // Окончания для плавности (опционально)
        enders: [
            "эль", "иль", "аль", "оль", "уль", "ан", 
            "эн", "ин", "он", "ун", "ар", "эр", "ир", "ор"
        ],
        familyPrefixes: [
            // Природные элементы
            "Гала",     // Свет
            "Силь",     // Серебро
            "Лау",      // Золото
            "Аэ",       // Воздух
            "Аль",      // Свет
            "Иль",      // Звезда
            "Ол",       // Сон
            "Эль",      // Звезда
            "Келеб",    // Серебро
            "Аран",     // Король
            // Географические
            "Лори",     // Сон
            "Имлад",    // Долина
            "Эред",     // Гора
            "Нен",      // Вода
            "Таур",     // Лес
            "Пелон",    // Башня
            "Кирит",    // Расселина
            "Амон",     // Холм
            "Барад",    // Башня
            "Карн"      // Красный
        ],
    
        // Фамильные суффиксы (на эльфийском)
        familySuffixes: [
            // Места и строения
            "рим",      // Опора
            "дор",      // Земля
            "линд",     // Песня
            "ронд",     // Купол
            "стиль",    // Сияние
            "винг",     // Пена
            "тиль",     // Остриё
            "мир",      // Драгоценность
            "дил",      // Друг
            "фин",      // Волосы
            // Качества и состояния
            "ион",      // Сын
            "иэль",     // Дочь
            "ронд",     // Пещера
            "вайн",     // Юный
            "бет",      // Слово
            "росс",     // Роса
            "мар",      // Жилище
            "нор",      // Огонь
            "фэйн",     // Белый
            "мор"       // Тёмный
        ],
        familyMiddles: [
            "а", "э", "и", "о", "у",
            "ад", "эд", "ид", "од", "уд",
            "ан", "эн", "ин", "он", "ун",
            "ар", "эр", "ир", "ор", "ур"
        ],
    },
    "human": {
        // Общие начальные слоги (разные культурные влияния)
        prefixes: [
            // Англо-саксонские/германские
            "Аль", "Эль", "Виль", "Ос", "Тор", "Лео", "Эд", "Вин", "Сиг", "Год",
            // Романские/южные
            // "Лю", "Мар", "Жан", "Пьер", "Сер", "Рай", "Дом", "Фран", "Кар",
            // Славянские/восточные
            "Яро", "Вла", "Ста", "Бо", "Дра", "Рад", "Свя", "Ми", "Бро", "Ка",
            // Скандинавские/северные
            "Рагн", "Бьорн", "Эй", "Халь", "Гун", "Свен", "Ульф", "Ха", "Фрей", "Инг",
            // Универсальные
            "Ар", "Эр", "Ор", "Бен", "Джон", "Виль", "Том", "Рик", "Ген", "Сам"
        ],
        
        // Средние слоги
        middles: [
            "ри", "ли", "ни", "си", "ти", "ви", "ди", "ми",
            "бер", "дер", "тер", "вер", "гер", "мер", "нер", "пер",
            "ман", "ван", "дан", "ран", "тан", "фан", "ган", "лан",
            "мон", "нон", "рон", "сон", "тон", "фон", "гон", "хон",
            "кар", "лар", "мар", "нар", "тар", "фар", "гар", "хар"
        ],
        
        // Общие суффиксы
        suffixes: [
            "ард", "берт", "вин", "гард", "дел", "ерт", "фрид", "хард",
            "иль", "киль", "линд", "мунд", "нор", "ольф", "рик", "сон",
            "ульф", "вард", "хельм", "цель", "шер", "эрт", "юст", "ярд"
        ],
        
        // Женские суффиксы
        femaleSuffixes: [
            "а", "иа", "ела", "ила", "ола", "ула", "ина", "ена",
            "етта", "иетта", "елина", "ильда", "ольда", "ульда",
            "мира", "вира", "лира", "тира", "фара", "гара",
            "линда", "синда", "тинда", "винда", "гринда",
            "белла", "делла", "фелла", "гелла", "телла",
            "анна", "энна", "инна", "онна", "унна"
        ],
        
        // Мужские суффиксы
        maleSuffixes: [
            "ус", "ис", "ос", "ас", "ес", "ан", "ен", "ин", "он", "ун",
            "ар", "ер", "ир", "ор", "ур", "ард", "ерд", "ирд", "орд", "урд",
            "альд", "ельд", "ильд", "ольд", "ульд", "анд", "енд", "инд", "онд", "унд",
            "ерт", "ирт", "орт", "урт", "арт", "ерт", "орм", "урм", "арм", "ерм"
        ],
        
        // Фамильные приставки (для благозвучности)
        familyPrefixes: [
            "фон", "ван", "де", "ди", "ла", "ле", "мак", "о'", "ап", "фитц",
            "берг", "бург", "гард", "хольм", "стад", "вик", "даль", "таль",
            "ривер", "стоун", "айрон", "голд", "сильвер", "блэк", "уайт", "гри"
        ],
        
        // Фамильные суффиксы
        familySuffixes: [
            "сон", "сен", "ович", "евич", "ов", "ев", "ин", "ын",
            "ский", "цкий", "ской", "цкой", "иль", "оль", "аль", "ель",
            "ман", "нер", "лер", "мер", "вер", "дер", "тер", "бер",
            "ворд", "ланд", "бург", "берг", "хольм", "стад", "даль", "таль"
        ]
    },
    "dwarf": {
        // Начальные слоги (крепкие и гортанные)
        prefixes: [
            // Основательные
            "Тор", "Гор", "Дур", "Бал", "Два", "Гим", "Фун", "Бор", "Нал", "Ор",
            // Камень/металл
            "Гран", "Стен", "Краг", "Флин", 
            // Традиционные
            "Гро", "Тро", "Дро", "Фро", "Про", "Кро", "Мро", "Вро", "Зро", "Рро",
            "Гром", "Каз", "Хаг", "Ск", "Гун", "Фар"
        ],
        
        // Средние слоги (соединительные)
        middles: [
            "ад", "ин", "ан", "ун", "ен", "он", "ян", "эн", "инн", "анн", "унн",
            "ар", "ур", "ор", "ер", "ир", "яр", "юр", "орр", "арр", "урр",
            "ли", "ри", "ни", "ди", "ти", "ви", "ми", "би", "пи", "ки",
            "гар", "дар", "нар", "тар", "вар", "мар", "ргар", "лдар", "ннар"
        ],
        
        // Общие суффиксы
        suffixes: [
            "ин", "ан", "ун", "ар", "ур", "ор", "ир", "ард", "урд", "орд",
            "грим", "лим", "дим", "тим", "вим", "вин", "ли", "дин", "дар",
            "гаар", "даар", "наар", "таар", "ваар", "маар", "раар", "лаар"
        ],
        
        // Женские суффиксы (немного мягче)
        femaleSuffixes: [
            "а", "иа", "ела", "ила", "ола", "ула", "ина", "ена", "она", "уна",
            "дис", "тис", "вис", "нис", "рис", "лис", "мис", "бис", "пис", "кис",
            "лин", "тин", "вин", "нин", "рин", "линн", "тинн", "винн", "нинн", "ринн"
        ],
        
        // Мужские суффиксы (более жёсткие)
        maleSuffixes: [
            "и", "ей", "ай", "ой", "уй", "ейн", "айн", "ойн", "уйн", "ейнн",
            "гар", "дар", "нар", "тар", "вар", "мар", "ргар", "лдар", "ннар", "ттар",
            "сток", "стокк", "локк", "рокк", "бокк", "докк", "токк", "вокк", "мокк"
        ],
         // Фамильные приставки (на дварфьем)
    familyPrefixes: [
        // Камни и металлы
        "Бр",
        "Гим",
        "Грон",     // Камень
        "Краг",     // Скала
        "Флин",     // Кремень
        "Каз",     // Железо
        "Тор",
        "Грун",
        "Харт",
        "Бар",
        "Галл",
        "Стрен",
        "Фельд",
        "Бро",
        "Гор",
        "Дро",
        "Краг",
        "Хард",
        "Ульф",
        "Копп",     // Медь
        "Адам",     // Адамантий
        "Деп",      // Глубина
        "Унд",      // Подземье
        "Стоун",    // Камень (человеч.)
        "Мура",
        "Рок"       // Скала (человеч.)
    ],

    // Фамильные суффиксы (на дварфьем)
    familySuffixes: [
        // Мастерство и действия
        "ли",
        "дин",
        "гар",
        "рук",
        "дир",
        "мар",
        "рин",
        "так",
        "нар",
        "вал",
        "вил",
        "рен",
        "лен",
        "док",
        "менд",
        "хильд",
        "дис",
        "рид",
        "борг",
        "вига",
        "рун",
        "дил",
        "вейг",
        "дис",
        "ур",
        "унд"
    ],

    // Фамильные соединительные слоги
    familyMiddles: [
        "ан", "ен", "ин", "он", "ун",
        "ар", "ер", "ир", "ор", "ур",
        "гар", "дар", "нар", "тар", "вар",
        "лин", "рин", "тин", "вин", "мин"
    ],
    },
    "halfling": {
        // Начальные слоги (мягкие и природные)
        prefixes: [
            // Природные
            "Сэм", "Бил", "Фрод", "Мер", "Пер", "Рос", "Дей", "Поп", "Ла", "Ферн",
            // Уютные/деревенские
            "Тео", "Фос", "Бин", "Мар", "Ан", "Гор", "Трот", "Дро", "Вил", "Хоб",
            // Простые радости
            "Бер", "Чиз", "Хон", "Ап", "Плам", "Грей", "Оат", "Бар", "Пай", "Кейк"
        ],
        
        // Средние слоги (соединительные, плавные)
        middles: [
            "ви", "ли", "ни", "ри", "ти", "ди", "ми", "би", "пи", "ки",
            "бер", "дер", "тер", "вер", "мер", "нер", "пер", "кер", "лер", "сер",
            "бо", "до", "го", "ло", "мо", "но", "по", "ро", "со", "то",
            "ба", "да", "га", "ла", "ма", "на", "па", "ра", "са", "та"
        ],
        
        // Общие суффиксы
        suffixes: [
            "виз", "лоу", "тофт", "бёрроу", "григгс", "бэнкс", "брук", "дейл", "филд", "вуд",
            "боттом", "грин", "хилл", "лейк", "марш", "ридж", "спринг", "вейл", "уэлл", "ёрт"
        ],
        
        // Женские суффиксы
        femaleSuffixes: [
            "а", "иа", "белла", "белл", "роуз", "мэй", "джейн", "лин", "линн", "етта",
            "анна", "энна", "инна", "онна", "унна", "елиза", "емили", "еттель", "ильда", "ольга",
            "поппи", "дейзи", "виолет", "айрис", "хейзел", "лавдер", "олив", "руби", "пеarl", "голди"
        ],
        
        // Мужские суффиксы
        maleSuffixes: [
            "о", "ио", "берт", "альд", "ольф", "ред", "рик", "си", "ти", "ви",
            "бин", "вин", "кин", "лин", "мин", "пин", "рин", "тин", "вин", "зин",
            "эр", "ар", "ор", "ур", "ир", "яр", "юр", "ард", "ерд", "орд"
        ],
        
        // Семейные приставки (для фамилий)
        // Фамильные приставки (на халфлингском)
    familyPrefixes: [
        // Еда и напитки
        "Ячмен",    // Ячмень
        "Пирож",    // Пирог
        "Сыр",  // Сыровар
        "Мед",  // Медовар
        "Хлеб",     // Хлеб
        "Прян",   // Пряник
        "Блин",     // Блин
        "Сахар",    // Сахар
        "Солод",    // Солод
        "Вишн",     // Вишня
        // Природа и уют
        "Трав",     // Трава
        "Корен",    // Корень
        "Лист",     // Лист
        "Пол",     // Поле
        "Сад",      // Сад
        "Очаг",     // Очаг
        "Дым",      // Дым
        "Плет",   // Плетёный
        "Уют",      // Уют
        "Тепл"      // Тёплый
    ],

    // Фамильные суффиксы (на халфлингском)
    familySuffixes: [
        // Предметы быта
        "овка",     // Уменьшительное
        "ушко",     // Ласкательное
        "ик",       // Уменьшительное
        "ок",       // Уменьшительное
        "енька",    // Ласкательное
        "очка",     // Уменьшительное
        "ушка",     // Ласкательное
        "ышко",     // Уменьшительное
        "це",       // Уменьшительное
        "ко",       // Уменьшительное
        // Качества
        "пёк",      // Пёк
        "вар",      // Варил
        "сел",      // Сеял
        "пас",      // Пасс
        "пёл",     // Плёл
        "шил",      // Шил
        "мол",    // Молол
        "сух",    // Сушил
        "коп"     // Копил
    ],

    // Фамильные соединительные слоги
    familyMiddles: [
        "о", "е", "и", "у", "ю",
        "ов", "ев", "ив", "ов", "ев",
        "ан", "ен", "ин", "он", "ун",
        "ар", "ер", "ир", "ор", "ур"
    ],
    },
    "dragonborn": {
        // Начальные слоги (мощные и гортанные)
        prefixes: [
            // Стихийные
            "Ар", "Игн", "Вул", "Глац", "Цим", "Хидр", "Электр", "Терр", "Аэр", "Нокт",
            // Анатомия драконов
            "Драк", "Скор", "Ксил", "Вор", "Гнэ", "Зхар", "Крикс", "Тарн", "Фанг", "Коготь",
            // Абстрактные понятия
            "Вор", "Кор", "Зор", "Мор", "Нор", "Ракс", "Векс", "Зекс", "Мекс", "Рекс"
        ],
        
        // Средние слоги (соединительные, резкие)
        middles: [
            "ар", "ур", "ор", "ир", "яр", "юр", "аар", "уур", "оор", "иир",
            "ти", "ри", "ни", "си", "ви", "ди", "ми", "ли", "ки", "пи",
            "гх", "кх", "тх", "зх", "сх", "вх", "дх", "мх", "рх", "лх",
            "ск", "зк", "вк", "дк", "мк", "рк", "лк", "нк", "тк", "пк"
        ],
        
        // Общие суффиксы
        suffixes: [
            "арн", "урн", "орн", "ирн", "ярн", "юарн", "уурн", "оорн", "иирн", "аарн",
            "акс", "укс", "окс", "икс", "якс", "юкс", "аакс", "уукс", "оокс", "иикс",
            "ион", "уон", "оон", "иан", "уан", "оан", "ианн", "уанн", "оанн", "ионн"
        ],
        
        // Женские суффиксы (немного более мелодичные)
        femaleSuffixes: [
            "а", "иа", "уа", "оа", "я", "ю", "е", "и", "у", "о",
            "ара", "ура", "ора", "ира", "яра", "юра", "ера", "ира", "ура", "ора",
            "ия", "уя", "оя", "ия", "уя", "оя", "ия", "уя", "оя", "ея"
        ],
        
        // Мужские суффиксы (более резкие)
        maleSuffixes: [
            "ус", "ос", "ас", "ес", "ис", "юс", "яс", "еус", "иус", "оус",
            "ар", "ор", "ур", "ир", "яр", "юр", "аар", "оор", "уур", "иир",
            "ух", "ох", "ах", "ех", "их", "юх", "ях", "еух", "иух", "оух"
        ],
        
        familyPrefixes: [
            // Стихии
            "Игни",     // Огонь
            "Глаци",    // Лёд
            "Фульгу",   // Молния
            "Терра",    // Земля
            "Акви",     // Вода
            "Аэри",     // Воздух
            "Умбра",    // Тень
            "Люмен",    // Свет
            "Вулка",    // Вулкан
            "Темпе",    // Буря
            // Драконьи атрибуты
            "Драко",    // Дракон
            "Скор",     // Чешуя
            "Винг",     // Крыло
            "Когни",    // Коготь
            "Фанг",     // Клык
            "Хорн",     // Рог
            "Тейл",     // Хвост
            "Брин",     // Грива
            "Скайл",    // Чешуя
            "Плаум"     // Оперение
        ],
    
        // Фамильные суффиксы (на драконьем)
        familySuffixes: [
            // Сила и мощь
            "рикс",     // Правитель
            "торн",     // Шип
            "зарн",     // Ярость
            "валь",     // Власть
            "грах",     // Гнев
            "скор",     // Безумие
            "нар",      // Огонь
            "рот",      // Кровь
            "зул",      // Тень
            "файр",     // Пламя
            // Наследие
            "клав",     // Коготь
            "фанг",     // Клык
            "хорн",     // Рог
            "скейл",    // Чешуя
            "винг",     // Крыло
            "тейл",     // Хвост
            "брин",     // Грива
            "савр",     // Ящер
            "дракс",    // Дракон
            "вис"       // Сила
        ],
    
        // Фамильные соединительные слоги
        familyMiddles: [
            "ар", "ур", "ор", "ир", "яр",
            "ан", "ун", "он", "ин", "ен",
            "ак", "ук", "ок", "ик", "ек",
            "ас", "ус", "ос", "ис", "ес"
        ]
    },
    "tiefling": {
        // Начальные слоги (элегантные с демоническим оттенком)
        prefixes: [
            // Инфернальные
            "Зэр", "Мал", "Нок", "Весп", "Люц", "Сана", "Дамар", "Сераф", "Зар", "Амон",
            // Теневые
            "Умбр", "Тенеб", "Нокт", "Скор", "Мор", "Хел", "Эреб", "Стиг", "Ахер", "Флег",
            // Искусительные
            "Кали", "Неме", "Лилит", "Хекат", "Белладон", "Испе", "Вале", "Эли", "Изол", "Ориан"
        ],
        
        // Средние слоги (соединительные, мистические)
        middles: [
            "и", "а", "о", "у", "э", "я", "ю", "е", 
            "ри", "ли", "ни", "си", "ти", "ви", "ди", "ми",
            "ар", "ур", "ор", "ир", "яр", "ер", "ор", "ар",
            "кс", "з", "с", "т", "в", "д", "м", "р"
        ],
        
        // Общие суффиксы
        suffixes: [
            "иэль", "аэль", "ион", "арон", "орион", "ирион", "урион", "арион",
            "иус", "аус", "орис", "ирис", "арис", "урис", "эрис", "ирис"
        ],
        
        // Женские суффиксы (более мелодичные)
        femaleSuffixes: [
            "а", "иа", "ея", "ия", "оя", "уя", "ела", "ила", "ола", "ула",
            "исса", "есса", "исса", "осса", "усса", "етта", "итта", "отта", "утта",
            "инна", "енна", "анна", "онна", "унна", "ели", "или", "оли", "ули"
        ],
        
        // Мужские суффиксы (более резкие)
        maleSuffixes: [
            "ус", "ос", "ас", "ес", "ис", "он", "ан", "ен", "ин", "ун",
            "ор", "ар", "ур", "ир", "ер", "орр", "арр", "урр", "ирр", "ерр",
            "ок", "ак", "ек", "ик", "ук", "окс", "акс", "екс", "икс", "укс"
        ],
        
        // Инфернальные приставки (для фамилий)
       // Фамильные приставки (на инфернальном)
    familyPrefixes: [
        // Инфернальные сущности
        "Азра",     // Пепел
        "Малфе",    // Зло
        "Нокс",     // Ночь
        "Скорт",    // Боль
        "Круор",    // Кровь
        "Умбр",     // Тень
        "Игни",     // Огонь
        "Пирро",    // Пламя
        "Випер",    // Змея
        "Стиг",     // Стигия
        // Демонические атрибуты
        "Демо",     // Демон
        "Инфер",    // Ад
        "Аббад",    // Бездна
        "Тартар",   // Тартар
        "Дис",      // Дис
        "Ахер",     // Ахерон
        "Флег",     // Флегетон
        "Коши",     // Кош
        "Вейл",     // Вуаль
        "Грим"      // Мрачный
    ],

    // Фамильные суффиксы (на инфернальном)
    familySuffixes: [
        // Проклятия и порча
        "карн",     // Плоть
        "торн",     // Шип
        "зорн",     // Гнев
        "морн",     // Смерть
        "норн",     // Судьба
        "вис",      // Сила
        "тис",      // Огонь
        "кис",      // Ненависть
        "мис",      // Тайна
        "нис",      // Ноша
        // Демонические качества
        "торикс",   // Мука
        "морикс",   // Смерть
        "зорикс",   // Ярость
        "норикс",   // Тьма
        "вирикс",   // Искажение
        "кан",      // Проклятие
        "ман",      // Рука
        "нан",      // Клык
        "ван",      // Вена
        "зан"       // Цепь
    ],

    // Фамильные соединительные слоги
    familyMiddles: [
        "ар", "ур", "ор", "ир", "ер",
        "ан", "ун", "он", "ин", "ен",
        "ак", "ук", "ок", "ик", "ек",
        "ас", "ус", "ос", "ис", "ес"
    ],
    },
    "half-orc": {
        // Начальные слоги (короткие и жёсткие)
        prefixes: [
            "Гар", "Гор", "Гур", "Гхор", "Гхур",
            "Дар", "Дор", "Дур", "Дрог", "Драг",
            "Мог", "Муг", "Мар", "Мор", "Мур",
            "Шар", "Шор", "Шур", "Шраг", "Штур",
            "Хаг", "Хуг", "Хар", "Хор", "Хур",
            "Брог", "Браг", "Бур", "Бор", "Бар",
            "Луг", "Лаг", "Лор", "Лур", "Лар",
            "Снар", "Сног", "Стур", "Скар", "Скор",
            "Ульф", "Урс", "Уг", "Ур", "Ул",
            "Раз", "Руг", "Рар", "Рор", "Рур",
            "Горд", "Гард", "Гурд", "Гхар", "Гхурд"
        ],
        
        // Средние слоги (соединительные, часто гортанные)
        middles: [
            "зу", "гу", "ку", "ту", "фу",
            "за", "га", "ка", "та", "фа",
            "зо", "го", "ко", "то", "фо",
            "зи", "ги", "ки", "ти", "фи",
            "гх", "кх", "тх", "фх", "зг",
            "рг", "кг", "тг", "фг", "зг",
            "нк", "нг", "нт", "нф", "нз",
            "рк", "рг", "рт", "рф", "рз"
        ],
        
        // Общие суффиксы
        suffixes: [
            "з", "г", "к", "т", "ф",
            "за", "га", "ка", "та", "фа",
            "зо", "го", "ко", "то", "фо",
            "зи", "ги", "ки", "ти", "фи",
            "гук", "зук", "кук", "тук", "фук",
            "гар", "зар", "кар", "тар", "фар",
            "гор", "зор", "кор", "тор", "фор"
        ],
        
        // Женские суффиксы (немного мягче)
        femaleSuffixes: [
            "га", "за", "ка", "та", "фа",
            "ги", "зи", "ки", "ти", "фи",
            "ша", "жа", "ча", "ща", "ра",
            "ши", "жи", "чи", "щи", "ри",
            "на", "ма", "ла", "ра", "ва",
            "ни", "ми", "ли", "ри", "ви"
        ],
        
        // Мужские суффиксы (более жёсткие)
        maleSuffixes: [
            "г", "з", "к", "т", "ф",
            "гх", "зг", "кг", "тг", "фг",
            "рг", "рк", "рт", "рф", "рз",
            "нк", "нг", "нт", "нф", "нз",
            "ук", "уг", "ут", "уф", "уз",
            "ак", "аг", "ат", "аф", "аз",
            "ок", "ог", "от", "оф", "оз"
        ],
        
        // Приставки для усиления (опционально)
        starters: [
            "Гро", "Грох", "Грах", "Грух",
            "Дро", "Дрох", "Драх", "Друх",
            "Мро", "Мрох", "Мрах", "Мрух",
            "Шро", "Шрох", "Шрах", "Шрух",
            "Хро", "Хрох", "Храх", "Хрух"
        ],
        
        // Окончания для усиления (опционально)
        enders: [
            "х", "хх", "кх", "гх", "тх",
            "ш", "шш", "ч", "чч", "щ",
            "рр", "гг", "кк", "тт", "фф"
        ],
            // Фамильные приставки (на орочьем)
    familyPrefixes: [
        // Части тела/анатомия
        "Гро",
        "Гул",
        "Скор",
        "Гом",
        "Гло",
        "Грил",
        "Гро",
        "Гром",
        "Грот",
        "Гроф",
        "Гхур",     // Горло
        "Дак",      // Палец
        "Гхун",     // Кость
        "Зуг",      // Зуб
        "Муг",      // Кулак
        "Руг",      // Рука
        "Туг",      // Нога
        "Гхор",
        "Грох",
        "Гулх",
        "Скорх",
        "Гомх",
        "Глох",
        "Грилх",
        "Тар",
        "Хаг",      // Череп
        "Краг",     // Спина
        "Брог",     // Кишка
        // Природные элементы
        "Гор",      // Камень
        "Дарг",     // Тёмный
        "Гхор",     // Грязь
        "Шар",      // Кровь
        "Уг",       // Огонь
        "Луг",      // Пещера
        "Стуг",     // Тень
        "Гхол",     // Яма
        "Бург",     // Крепость
        "Дрог",      // Обрыв
        "Мар",
        "Нар",
    ],

    // Фамильные суффиксы (на орочьем)
    familySuffixes: [
        "фанг",
        "зан",
        "гаш",
        "кан",
        "рул",
        "ток",
        "дан",
        "раш",
        "маш",
        "алл",
        "нах",
        "зан",
        "зул",
        "фара",
        "неш",
        "рог",
        // Действия/состояния
        "баг",      // Ломать
        "даг",      // Резать
        "раг",      // Рвать
        "шаг",      // Убивать
        "фак",      // Бить
        "так",      // Крушить
        "ваг",      // Гнить
        "наг",      // Жевать
        "лаг",      // Лежать
        "стаг",     // Стоять
        // Качества
        "хед",      // Твёрдый
        "год",      // Злой
        "род",      // Красный
        "год",      // Старый
        "зад",      // Сильный
        "пад",      // Быстрый
        "кад",      // Острый
        "мад",      // Глупый
        "сад",      // Голодный
        "вад"       // Дикий
    ],

    // Фамильные соединительные слоги
    familyMiddles: [
        "зу", "гу", "ку", "ту", "фу",
        "за", "га", "ка", "та", "фа", 
        "зо", "го", "ко", "то", "фо",
        "гх", "кх", "тх", "фх", "зх"
    ],
    },
    "half-elf": {
        // Начальные слоги (гибридные - эльфийские и человеческие)
        prefixes: [
            // Эльфийское влияние
            "Ал", "Эл", "Ил", "Ар", "Эр", "Аэ", "Эа", "Ла", "Ле", "Ли", 
            // Человеческое влияние
            "Джо", "Виль", "Эд", "Том", "Бен", "Сам", "Рик", "Мар", "Лю", "Жан",
            // Универсальные гибридные
            "Аран", "Эриан", "Илиан", "Ориан", "Уриан", "Каэл", "Реан", "Теан", "Веан", "Сеан"
        ],
        
        // Средние слоги (сбалансированные)
        middles: [
            "ри", "ли", "ни", "си", "ти", "ви", "ди", "ми", "би", "пи",
            "ан", "ен", "ин", "он", "ун", "ян", "енн", "инн", "онн", "унн",
            "ар", "ер", "ир", "ор", "ур", "яр", "ерр", "ирр", "орр", "урр",
            "дел", "тел", "вел", "нел", "рел", "сел", "кел", "мел", "пел", "фел"
        ],
        
        // Общие суффиксы (универсальные)
        suffixes: [
            "ан", "ен", "ин", "он", "ун", "ар", "ер", "ир", "ор", "ур",
            "иль", "аль", "ель", "оль", "уль", "иус", "аус", "еус", "иус", "оус"
        ],
        
        // Женские суффиксы (элегантные но доступные)
        femaleSuffixes: [
            "а", "иа", "ея", "ия", "ела", "ила", "ола", "ула", "ина", "ена",
            "етта", "итта", "отта", "утта", "ели", "или", "оли", "ули", "анна", "енна",
            "лин", "линн", "рин", "ринн", "син", "синн", "тин", "тинн", "вин", "винн"
        ],
        
        // Мужские суффиксы (благородные но сильные)
        maleSuffixes: [
            "ор", "ар", "ур", "ир", "ер", "ан", "ен", "ин", "он", "ун",
            "ард", "ерд", "ирд", "орд", "урд", "альд", "ельд", "ильд", "ольд", "ульд",
            "рик", "дик", "мик", "ник", "тик", "вик", "лик", "сик", "кик", "пик"
        ],
        
        // Фамильные приставки (для фамилий)
        familyPrefixes: [
            "Грин", "Силвер", "Голд", "Блэк", "Уайт", "Ред", "Блу", "Грей", "Браун", "Фэйр",
            "Стоун", "Айрон", "Стил", "Вуд", "Филд", "Хилл", "Ривер", "Лейк", "Си", "Скай",
            "Ара", "Эль", "Ил", "Оро", "Уру", "Ла", "Ле", "Ли", "Ло", "Лу",
            "Сил", "Гал", "Мел", "Пел", "Кел", "Тел", "Вел", "Нел", "Рел", "Селе"
        ],
        
        // Фамильные суффиксы (гибридные)
        familySuffixes: [
            "филд", "вуд", "ридж", "вейл", "брук", "дейл", "холм", "лейк", "шор", "порт",
            "риэль", "диэль", "тиэль", "виэль", "ниэль", "рон", "дон", "тон", "фон", "вон"
        ]
    },
    "gnome": {
        // Начальные слоги (витиеватые и технические)
        prefixes: [
            // Механические
            "Глим", "Зук", "Тим", "Физ", "Спар", "Гир", "Ког", "Видж", "Гадж", "Спринг",
            // Природные/драгоценные
            "Брил", "Глим", "Спин", "Твинк", "Флип", "Пиб", "Ним", "Зиз", "Диз", "Биз",
            // Традиционные
            "Элдо", "Фило", "Кип", "Бод", "Стер", "Флин", "Поп", "Зук", "Винк", "Блинк"
        ],
        
        // Средние слоги (соединительные, пружинистые)
        middles: [
            "и", "а", "о", "у", "э", "я", "ю", "е",
            "бер", "дер", "кер", "лер", "мер", "нер", "пер", "тер",
            "бо", "до", "го", "ло", "мо", "но", "по", "ро",
            "бле", "гле", "кле", "пле", "тле", "вле", "зле", "сле"
        ],
        
        // Общие суффиксы
        suffixes: [
            "л", "р", "н", "т", "с", "з", "к", "п", "в", "м",
            "вик", "лик", "ник", "тик", "вик", "зик", "сик", "рик",
            "гет", "дет", "кет", "лет", "мет", "нет", "пет", "тет"
        ],
        
        // Женские суффиксы (более мелодичные)
        femaleSuffixes: [
            "а", "иа", "ела", "ила", "ола", "ула", "ина", "ена",
            "етта", "итта", "отта", "утта", "ели", "или", "оли", "ули",
            "лин", "линн", "рин", "ринн", "син", "синн", "тин", "тинн"
        ],
        
        // Мужские суффиксы (более технические)
        maleSuffixes: [
            "о", "ио", "бо", "до", "го", "ло", "мо", "но", "по", "ро",
            "бус", "дус", "гус", "лус", "мус", "нус", "пус", "рус",
            "гл", "дл", "кл", "пл", "тл", "вл", "зл", "сл"
        ],
        
        // Приставки (для фамилий)
        familyPrefixes: [
            // Искры и свет
            "Зин",      // Искра
            "Блик",     // Блеск
            "Сверк",    // Сверкание
            "Мерц",     // Мерцание
            "Сиян",     // Сияние
            "Лун",      // Лунный свет
            "Солн",     // Солнечный
            "Зар",      // Заря
            "Огн",      // Огонёк
            "Плам",     // Пламя
            // Механизмы
            "Верт",     // Вращение
            "Сквор",    // Скворчание
            "Трещ",     // Треск
            "Щелк",     // Щелчок
            "Жужж",     // Жужжание
            "Гуд",      // Гудение
            "Свист",    // Свист
            "Шип",      // Шипение
            "Бряк",     // Брякание
            "Стук"      // Стук
        ],
    
        // Фамильные суффиксы (на гномьем)
        familySuffixes: [
            // Действия и процессы
            "ка",       // Уменьшительное
            "ец",       // Делатель
            "ик",       // Мастер
            "ун",       // Деятель
            "ач",       // Работник
            "аль",      // Создатель
            "иль",      // Творец
            "арь",      // Ремесленник
            "ист",      // Специалист
            "ер",       // Деятель
            // Качества
            "кий",      // Качество
            "ный",      // Свойство
            "ливый",    // Склонность
            "чивый",    // Способность
            "ячий",     // Принадлежность
            "ащий",     // Действие
            "ящий",     // Процесс
            "учий",     // Умение
            "ящий",     // Навык
            "щий"       // Качество
        ],
    
        // Фамильные соединительные слоги
        familyMiddles: [
            "о", "е", "и", "у", "ю",
            "ко", "ло", "мо", "но", "ро",
            "ка", "ла", "ма", "на", "ра",
            "че", "ше", "ще", "це", "це"
        ],
    },
};

// Аутентичные эльфийские корни и значения (на основе реальных эльфийских языков)
const ELVEN_ROOTS = {
    // Свет и звезды
    light: {
        prefixes: ["Сил", "Гил", "Эл", "Ал", "Ил", "Ол", "Ул", "Ал", "Эл", "Ил"],
        roots: ["ан", "ар", "ас", "ат", "ав", "аг", "ад", "ак", "ал", "ам", "ан", "ар", "ас", "ат", "ав"],
        suffixes: ["ион", "иэль", "иль", "ион", "иэль", "иль", "ион", "иэль", "иль", "ион"]
    },
    // Природные элементы
    nature: {
        prefixes: ["Аэл", "Ал", "Эл", "Ил", "Ол", "Ул", "Ал", "Эл", "Ил", "Ол"],
        roots: ["ан", "ар", "ас", "ат", "ав", "аг", "ад", "ак", "ал", "ам", "ан", "ар", "ас", "ат", "ав"],
        suffixes: ["ион", "иэль", "иль", "ион", "иэль", "иль", "ион", "иэль", "иль", "ион"]
    },
    // Вода и море
    water: {
        prefixes: ["Аэл", "Ал", "Эл", "Ил", "Ол", "Ул", "Ал", "Эл", "Ил", "Ол"],
        roots: ["ан", "ар", "ас", "ат", "ав", "аг", "ад", "ак", "ал", "ам", "ан", "ар", "ас", "ат", "ав"],
        suffixes: ["ион", "иэль", "иль", "ион", "иэль", "иль", "ион", "иэль", "иль", "ион"]
    },
    // Лес и деревья
    forest: {
        prefixes: ["Тау", "Лау", "Нау", "Рау", "Сау", "Вау", "Зау", "Кау", "Мау", "Пау"],
        roots: ["ри", "ли", "ни", "ри", "ли", "ни", "ри", "ли", "ни", "ри"],
        suffixes: ["иэль", "ион", "иль", "иэль", "ион", "иль", "иэль", "ион", "иль", "иэль"]
    }
};

// Аутентичные эльфийские фамилии с значениями
const ELVEN_SURNAMES = {
    // Световые фамилии
    light: [
        "Имяфель", "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль",
        "Сильванаэ", "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил",
        "Истельдарин", "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль"
    ],
    // Природные фамилии
    nature: [
        "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль", "Сильванаэ",
        "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил", "Истельдарин",
        "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль", "Лаэнор"
    ],
    // Водные фамилии
    water: [
        "Имяфель", "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль",
        "Сильванаэ", "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил",
        "Истельдарин", "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль"
    ],
    // Лесные фамилии
    forest: [
        "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль", "Сильванаэ",
        "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил", "Истельдарин",
        "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль", "Лаэнор"
    ]
};

// Богатая база данных аутентичных эльфийских имен (50+ уникальных вариантов)
const AUTHENTIC_ELVEN_NAMES = {
    male: [
        "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан",
        "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин",
        "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил", "Силарион", "Тауриэль", "Финдолас",
        "Элронд", "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег",
        "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль",
        "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан",
        "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин"
    ],
    female: [
        "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль",
        "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил",
        "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан", "Лиастра",
        "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль",
        "Сандорион", "Эланор", "Юваниэль", "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд",
        "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль",
        "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил"
    ]
};

// Богатая база данных аутентичных эльфийских фамилий (50+ вариантов)
const AUTHENTIC_ELVEN_SURNAMES = [
    "Имяфель", "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль",
    "Сильванаэ", "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил",
    "Истельдарин", "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль",
    "Лаэнор", "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль", "Сильванаэ",
    "Эленвиэ", "Ривион", "Квеллайн", "Ортарион", "Фендримир", "Аварион", "Таурил", "Истельдарин",
    "Явиэн", "Меллот", "Анарим", "Силмариэль", "Алмариэль", "Галадриэль", "Элдариэль", "Лаэнор",
    "Галандель", "Артанис", "Имладин", "Амратель", "Лотариэль", "Алмариэль", "Сильванаэ", "Эленвиэ"
];

// Базы данных фэнтезийных имен в кириллице
const CYRILLIC_FANTASY_NAMES = {
    elf: {
        male: [
            "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан",
            "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин",
            "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил", "Силарион", "Тауриэль", "Финдолас",
            "Элронд", "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег",
            "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль"
        ],
        female: [
            "Айриэль", "Илифия", "Келебриан", "Лиастра", "Мирель", "Аланис", "Белег", "Гильтониэль",
            "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль", "Сандорион", "Эланор", "Юваниэль", "Аэландил",
            "Силарион", "Тауриэль", "Финдолас", "Элронд", "Айриэль", "Илифия", "Келебриан", "Лиастра",
            "Мирель", "Аланис", "Белег", "Гильтониэль", "Лайтлиан", "Нимродэль", "Орофин", "Риннаэль",
            "Сандорион", "Эланор", "Юваниэль", "Аэландил", "Силарион", "Тауриэль", "Финдолас", "Элронд"
        ]
    },
    dwarf: {
        male: [
            "Торбин", "Громдар", "Балин", "Дурин", "Фаргрим", "Орик", "Хагар", "Каздар", "Моргрин", "Бордин",
            "Торгар", "Даин", "Гундар", "Флинт", "Скард", "Гимли", "Балин", "Двалин", "Нали", "Орин",
            "Лони", "Флои", "Эйрик", "Хаки", "Глордин", "Краги", "Мотри", "Солви", "Хогни", "Вольстен",
            "Эрланд", "Сигурд", "Йорунн", "Рагнхильд", "Ульфгар", "Торбин", "Громдар", "Балин", "Дурин", "Фаргрим",
            "Орик", "Хагар", "Каздар", "Моргрин", "Бордин", "Торгар", "Даин", "Гундар", "Флинт", "Скард"
        ],
        female: [
            "Хельга", "Ильда", "Брунгильда", "Фрейда", "Диса", "Хильдра", "Герта", "Катрин", "Астрид", "Сигрид",
            "Инге", "Бодрил", "Рангильда", "Гуннхильда", "Тордис", "Хельга", "Ильда", "Брунгильда", "Фрейда", "Диса",
            "Хильдра", "Герта", "Катрин", "Астрид", "Сигрид", "Инге", "Бодрил", "Рангильда", "Гуннхильда", "Тордис",
            "Хельга", "Ильда", "Брунгильда", "Фрейда", "Диса", "Хильдра", "Герта", "Катрин", "Астрид", "Сигрид",
            "Инге", "Бодрил", "Рангильда", "Гуннхильда", "Тордис", "Хельга", "Ильда", "Брунгильда", "Фрейда", "Диса"
        ]
    },
    human: {
        // Англо-саксонские / Средневековые европейские
        angloSaxon: {
            male: ["Элгар", "Осрик", "Торстен", "Леофрик", "Элдор", "Эдвин", "Беорн", "Кенрик", "Вульфрик", "Альдрик"],
            female: ["Хельга", "Виннифер", "Бритта", "Морвен", "Этельфлаед", "Годгифу", "Эльфгифу", "Вульфрун", "Эдита", "Гунхильд"]
        },
        // Континентальные / Барочные
        continental: {
            male: ["Арман", "Лоренц", "Серж", "Годфри", "Рено", "Анри", "Филипп", "Луи", "Пьер", "Жан"],
            female: ["Женевьева", "Изабель", "Катрин", "Одиль", "Клаудиа", "Мари", "Анн", "Клод", "Жанна", "Маргарита"]
        },
        // Славянские / Восточноевропейские
        slavic: {
            male: ["Казимир", "Драган", "Борис", "Станко", "Радослав", "Григор", "Владислав", "Станислав", "Богдан", "Ярослав"],
            female: ["Ярослава", "Зорина", "Милена", "Верица", "Катарина", "Анастасия", "Елена", "Мария", "Ольга", "Татьяна"]
        },
        // Южные / Средиземноморские
        mediterranean: {
            male: ["Алессандро", "Диего", "Лоренцо", "Рафаэль", "Мариус", "Антонио", "Джузеппе", "Франческо", "Марко", "Андреа"],
            female: ["Изабелла", "София", "Валентина", "Кассандра", "Элоиза", "Мария", "Анна", "Джулия", "Франческа", "Клаудия"]
        },
        // Экзотические / Смешанные
        exotic: {
            male: ["Тариан", "Зэйн", "Оррин", "Корван", "Фенрис", "Ансельм", "Даррен", "Кайден", "Зейн", "Орион"],
            female: ["Кайра", "Серена", "Лиана", "Джинн", "Ариэль", "Луна", "Стелла", "Нова", "Зара", "Миа"]
        }
    },
    halfling: {
        male: [
            "Теодред", "Фоссо", "Бинго", "Сэмло", "Марло", "Андер", "Гормо", "Тротер", "Фолко", "Дрого",
            "Бэрримен", "Гринбэк", "Хэвлок", "Гудчер", "Стоунфилд", "Ривербэнк", "Тандерс", "Хиллто", "Андерхилл", "Тук",
            "Вебстер", "Купер", "Флетчер", "Миллер", "Тэйлор", "Потер", "Смит", "Картер", "Мэйсон", "Фишер",
            "Брамбл", "Чизвик", "Берри", "Хонисуэлл", "Пламб", "Грейндж", "Эплби", "Хоппер", "Бейкер", "Гарденер",
            "Теодред", "Фоссо", "Бинго", "Сэмло", "Марло", "Андер", "Гормо", "Тротер", "Фолко", "Дрого"
        ],
        female: [
            "Примроуз", "Лавиния", "Эсмеральда", "Пенни", "Руби", "Поппи", "Дейзи", "Люси", "Марго", "Эшли",
            "Бэрримен", "Гринбэк", "Хэвлок", "Гудчер", "Стоунфилд", "Ривербэнк", "Тандерс", "Хиллто", "Андерхилл", "Тук",
            "Вебстер", "Купер", "Флетчер", "Миллер", "Тэйлор", "Потер", "Смит", "Картер", "Мэйсон", "Фишер",
            "Брамбл", "Чизвик", "Берри", "Хонисуэлл", "Пламб", "Грейндж", "Эплби", "Хоппер", "Бейкер", "Гарденер",
            "Примроуз", "Лавиния", "Эсмеральда", "Пенни", "Руби", "Поппи", "Дейзи", "Люси", "Марго", "Эшли"
        ]
    },
    dragonborn: {
        male: [
            "Арджек", "Криксус", "Торгар", "Ворлаг", "Зорг", "Гразз", "Драккар", "Скар", "Бартекс", "Хискар",
            "Ксерик", "Накс", "Орок", "Зерт", "Галак", "Фенро", "Йорг", "Крион", "Талос", "Ворун",
            "Орей", "Феррум", "Аргент", "Аурум", "Купрум", "Платина", "Стил", "Кобальт", "Вольфрам", "Оловус",
            "Рекс", "Империум", "Магнус", "Нобилис", "Вулкатус", "Инвиктус", "Арджек", "Криксус", "Торгар", "Ворлаг",
            "Зорг", "Гразз", "Драккар", "Скар", "Бартекс", "Хискар", "Ксерик", "Накс", "Орок", "Зерт"
        ],
        female: [
            "Вексия", "Игнисса", "Зара", "Тиамат", "Систра", "Ракса", "Мириль", "Ксифия", "Ноктура", "Вулкана",
            "Регия", "Прима", "Валирия", "Вексия", "Игнисса", "Зара", "Тиамат", "Систра", "Ракса", "Мириль",
            "Ксифия", "Ноктура", "Вулкана", "Регия", "Прима", "Валирия", "Вексия", "Игнисса", "Зара", "Тиамат",
            "Систра", "Ракса", "Мириль", "Ксифия", "Ноктура", "Вулкана", "Регия", "Прима", "Валирия", "Вексия",
            "Игнисса", "Зара", "Тиамат", "Систра", "Ракса", "Мириль", "Ксифия", "Ноктура", "Вулкана", "Регия"
        ]
    },
    tiefling: {
        male: [
            "Зэриэль", "Каинус", "Разиэль", "Веспасиан", "Люцифер", "Санаэль", "Дамарион", "Малфарий",
            "Серафин", "Зартос", "Амон", "Лерадж", "Нергал", "Эребос", "Мефисто", "Баал", "Астарот",
            "Данталион", "Фенрик", "Зепар", "Элион", "Каэлан", "Люциан", "Ориан", "Сильван", "Кассиан",
            "Соланж", "Ремус", "Феликс", "Клеменс", "Веру", "Спес", "КарИТас", "Пациенция", "Зэриэль",
            "Каинус", "Разиэль", "Веспасиан", "Люцифер", "Санаэль", "Дамарион", "Малфарий", "Серафин",
            "Зартос", "Амон", "Лерадж", "Нергал", "Эребос", "Мефисто", "Баал", "Астарот", "Данталион"
        ],
        female: [
            "Моргана", "Лилит", "Хеката", "Немея", "Калиста", "Исперия", "Белладонна", "Ноктюрна",
            "Серафина", "Валерия", "Илария", "Эола", "Изольда", "Аурелия", "Глория", "Пруденс", "Моргана",
            "Лилит", "Хеката", "Немея", "Калиста", "Исперия", "Белладонна", "Ноктюрна", "Серафина",
            "Валерия", "Илария", "Эола", "Изольда", "Аурелия", "Глория", "Пруденс", "Моргана", "Лилит",
            "Хеката", "Немея", "Калиста", "Исперия", "Белладонна", "Ноктюрна", "Серафина", "Валерия",
            "Илария", "Эола", "Изольда", "Аурелия", "Глория", "Пруденс", "Моргана", "Лилит", "Хеката"
        ]
    },
    gnome: {
        male: [
            "Элдорин", "Филиппер", "Глимвик", "Тимби", "Зуки", "Кипни", "Бодкин", "Стерли", "Флин", "Пибл",
            "Вондер", "Глим", "Зиззл", "Тинкер", "Физзл", "Спарк", "Гир", "Ког", "Глиммер", "Джинкл",
            "Брилл", "Эмбер", "Джаспер", "Руби", "Топаз", "Силк", "Перри", "Рози", "Баддл", "Седжи",
            "Элдорин", "Филиппер", "Глимвик", "Тимби", "Зуки", "Кипни", "Бодкин", "Стерли", "Флин", "Пибл",
            "Вондер", "Глим", "Зиззл", "Тинкер", "Физзл", "Спарк", "Гир", "Ког", "Глиммер", "Джинкл"
        ],
        female: [
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили",
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили",
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили",
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили",
            "Лиливик", "Митрил", "Нимбл", "Поппи", "Зиззи", "Дизи", "Пикси", "Тинкл", "Эллара", "Брили"
        ]
    },
    'half-orc': {
        male: [
            "Гарз", "Дарг", "Мог", "Шарк", "Хагрук", "Брог", "Горб", "Луг", "Снарл", "Ульф",
            "Разгар", "Гордум", "Зулган", "Дроггар", "Скарн", "Рагнар", "Корг", "Гнарр", "Снук", "Фенгар",
            "Дрол", "Гнолл", "Зорг", "Ворг", "Грим", "Хрош", "Борг", "Драк", "Грош", "Морг",
            "Зандар", "Крагг", "Торг", "Фанг", "Скарг", "Гарз", "Дарг", "Мог", "Шарк", "Хагрук",
            "Брог", "Горб", "Луг", "Снарл", "Ульф", "Разгар", "Гордум", "Зулган", "Дроггар", "Скарн"
        ],
        female: [
            "Шарка", "Барга", "Граба", "Мурга", "Ягга", "Хельда", "Ворга", "Зулла", "Гриза", "Урза",
            "Скалла", "Драга", "Морга", "Хурза", "Брогга", "Гарза", "Дарга", "Мога", "Шарка", "Хагрука",
            "Брога", "Горба", "Луга", "Снарла", "Ульфа", "Разгара", "Гордума", "Зулгана", "Дроггара", "Скарна",
            "Рагнара", "Корга", "Гнарра", "Снука", "Фенгара", "Дрола", "Гнолла", "Зорга", "Ворга", "Грима",
            "Хроша", "Борга", "Драка", "Гроша", "Морга", "Зандара", "Крагга", "Торга", "Фанга", "Скарга"
        ]
    }
};

// Богатые фэнтезийные фамилии в кириллице
const CYRILLIC_FANTASY_SURNAMES = {
    // Эльфийские фамилии (50+ вариантов)
    elf: [
        "Солнцеликий", "Луносвет", "Ветрогул", "Звездопад"
    ],
    // Дварфские фамилии (50+ вариантов) - аутентичные дварфские клановые имена
    dwarf: [
        "Казангар", "Торрук", "Грундир", "Хартмунд", "Бардок", "Галлмар", "Стренгар", "Фельдрин",
        "Бролен", "Гортак", "Дромар", "Крагнар", "Торвал", "Хардрен", "Ульфгар", "Стенвар",
        "Фьолнар", "Хогнар", "Бруни", "Гейрмунд", "Кетиль", "Эйольф", "Халльдор", "Веланд",
        "Регин", "Трасти", "Гизур", "Ормгард", "Ивар", "Эйнар", "Альвар", "Бьорн",
        "Лейф", "Хердис", "Сверрир", "Казангар", "Торрук", "Грундир", "Хартмунд", "Бардок",
        "Галлмар", "Стренгар", "Фельдрин", "Бролен", "Гортак", "Дромар", "Крагнар", "Торвал",
        "Хардрен", "Ульфгар", "Стенвар", "Фьолнар", "Хогнар", "Бруни", "Гейрмунд", "Кетиль",
        "Эйольф", "Халльдор", "Веланд", "Регин", "Трасти", "Гизур", "Ормгард", "Ивар"
    ],
    // Человеческие фамилии (50+ вариантов)
    human: {
        // Англо-саксонские / Средневековые европейские
        angloSaxon: [
            "Греймэн", "Стоунфист", "Айронсулд", "Хэммэрфол", "Гудбэрроу", "Фэрвуд", "Риверс", "Хэвлок",
            "Блэквуд", "Хоукридж", "Стоунбридж", "Айронвуд", "Голдфилд", "Силвертон", "Бронзхолл", "Копперфилд",
            "Вудбридж", "Ривертон", "Хиллкрест", "Вэлливью", "Форестхолл", "Мурленд", "Хэтхолл", "Гринфилд"
        ],
        // Континентальные / Барочные
        continental: [
            "Дюлак", "де Вейн", "Монтегю", "Вальдек", "де Роше", "Валлуа", "Лефевр", "фон Кагера",
            "Маршалк", "д'Энтин", "де Бурбон", "фон Габсбург", "де Медичи", "д'Эсте", "фон Гогенцоллерн", "де Валуа",
            "фон Виттельсбах", "д'Альбре", "де Монморанси", "фон Габсбург-Лотаринген", "д'Анжу", "де Бургундия", "фон Саксен-Кобург", "д'Орлеан"
        ],
        // Славянские / Восточноевропейские
        slavic: [
            "Светлый Меч", "Золотой Щит", "Благородный Рыцарь", "Добрый Сердце", "Мудрый Советник", "Храбрый Воин",
            "Честный Слово", "Верный Друг", "Сильный Дух", "Быстрый Ум", "Ловкий Рука", "Твердый Характер",
            "Мирный Покой", "Светлый Путь", "Золотая Дорога", "Серебряный Клинок", "Бронзовый Доспех", "Железная Воля",
            "Волков", "Зимань", "Огнян", "Ночной Ветер", "Громов", "Врана", "Рудина", "Стальной",
            "Драконова", "Скален", "Медведев", "Орлов", "Соколов", "Воронов"
        ],
        // Южные / Средиземноморские
        mediterranean: [
            "Коста", "Марино", "де ла Сьерра", "Орсини", "Вискарди", "Эспозито", "Торрес", "Сальваторе",
            "д'Анжер", "Флёр", "Романо", "Бьянки", "Росси", "Феррари", "Руссо", "Мартини", "Конти", "Риччи",
            "Моретти", "Бруно", "Галли", "Ломбарди", "Джордано", "Палермо", "Наполи", "Венеция"
        ],
        // Экзотические / Смешанные
        exotic: [
            "Штормволк", "Зимняя Тень", "Блэквуд", "Скайуокер", "Кэссл", "Мунфолл", "Сол", "Сандсторм",
            "Грей", "Редвин", "Файрстоун", "Айсбрейкер", "Тандерболт", "Фроствинд", "Шэдоуфолл", "Лайтбрингер",
            "Даркривер", "Старфолл", "Мунрайз", "Сансет", "Доунбрейкер", "Найтфолл", "Дейбрейкер", "Твайлайт"
        ]
    },
    // Халфлингские фамилии (50+ вариантов)
    halfling: [
        "Ячменовар", "Травопут", "Лукошко", "Корнеплод", "Пчелоносец", "Теплиц", "Дымокур", "Ручьевой",
        "Овинник", "Лежнеплод", "Рябинник", "Грибоедова", "Верескова", "Пирожкова", "Запеканка", "Солноверт",
        "Лукошечка", "Пряничина", "Лесопадова", "Рукавички", "Подкустов", "Пригоршня", "Запечный", "Перекати",
        "Межгор", "Лежебок", "Самоваров", "Покосив", "Кочедыжкин", "Завалинка", "Ткацкин", "Бондаренко",
        "Степловой", "Мельников", "Швейкин", "Горшочников", "Кузнецов", "Тележкин", "Каменщиков", "Рыбалов",
        "Ежевикин", "Сыроваров", "Ягоднов", "Медоваров", "Сливовкин", "Житнов", "Яблонов", "Хмелев",
        "Пирогов", "Огородов", "Ячменовар", "Травопут", "Лукошко", "Корнеплод", "Пчелоносец", "Теплиц"
    ],
    // Драконорожденные фамилии (50+ вариантов)
    dragonborn: [
        "Ворвидаггар", "Зилвиндор", "Игниварн", "Скорфист", "Малакор", "Гхондраксис", "Вултрон", "Оротрикс",
        "Фирнакс", "Зеритракс", "Ауридракс", "Пиррония", "Ксилотрикса", "Ноксарра", "Гласиос", "Электра",
        "Азрания", "Хидросса", "Умбракс", "Магмора", "Вердингар", "Терроксис", "Бриндаксий", "Ксилоник",
        "Цироний", "Корвидиан", "Стиджир", "Хеймраз", "Сандрекс", "Ашкар", "Хромакс", "Адамантис",
        "Митриллор", "Орхалкон", "Бронзорий", "Нидерим", "Вулдракс", "Азурион", "Тантарис", "Свингар",
        "Драконис", "Скайлор", "Доминаар", "Тиранус", "Империал", "Регалис", "Игнифер", "Виктрикс",
        "Стратос", "Аэтернис", "Ворвидаггар", "Зилвиндор", "Игниварн", "Скорфист", "Малакор", "Гхондраксис"
    ],
    // Тайфлинги (50+ вариантов)
    tiefling: [
        "Азракан", "Малфектар", "Ноктурнус", "Инфернус", "Тенебрис", "Умбрус", "Скортис", "Игнис",
        "Ксапракс", "Вулкракс", "Ноксия", "Круор", "Стигийя", "Сарказия", "Пирогения", "Фурия",
        "Виперра", "Обливия", "Ксеркселия", "Деспера", "Керзос", "Зитиос", "Таксис", "Зофос",
        "Фаустус", "Зебулон", "Каркарон", "Мнемос", "Стикс", "Ахерон", "Вандир", "Морденси",
        "Триксиан", "Сиренна", "Фаллакс", "Долоса", "Мендакс", "Фебрис", "Венефикум", "Фалласи",
        "Амаранта", "Инвиктус", "Виктория", "Фатум", "Анима", "Ментис", "Фидес", "Сальюс",
        "Амор", "ЛенИс", "Азракан", "Малфектар", "Ноктурнус", "Инфернус", "Тенебрис", "Умбрус"
    ],
    // Гномьи фамилии (50+ вариантов) - аутентичные гномьи фамилии
    gnome: [
        "Зербиндл", "Гаджетофус", "Спригглбут", "Наклглиммер", "Спарклендер", "Гирвистл", "Тинкербелл", "Вондершпиндель",
        "Когворт", "Фюззиджет", "Спиннель", "Глиммершпин", "Джуэлфлип", "Гаджетвистл", "Спригглспрокет", "Арканеген",
        "Твистлешпин", "Виджит", "Когворт", "Спарклфлай", "Гимер", "Сприггл", "Гаджет", "Накл",
        "Виджет", "Твистл", "Спиннер", "Флай", "Шпиндель", "Болт", "Стоунспин", "Риверглим",
        "Фернтриггер", "Спрингшпин", "Ливендер", "Брукбендер", "Пондлглиммер", "Хопперфлип", "Грассприг", "Ридлвистл",
        "Искрящийся механизм", "Хитроумное устройство", "Пружинящий сапог", "Блестящая заклёпка", "Дающий искры", "Свистящая шестерня", "Колокольчик мастера", "Чудесное веретено",
        "Достойный шестерни", "Нечёткий механизм", "Вертящаяся", "Блестящее вращение", "Ювелирный щелчок", "Свист механизма", "Шестерёнка с завитками", "Таинственный рычаг",
        "Вихревое вращение", "Живой механизм", "Достойная шестерни", "Искрящаяся муха", "Шестерёнка", "Завиток", "Приспособление", "Соединение",
        "Устройство", "Вихрь", "Пряха", "Полёт", "Веретено", "Болт", "Каменное вращение", "Речной блеск"
    ],
    // Полуорки (50+ вариантов) - аутентичные орочьи фамилии
    'half-orc': [
        "Гро'туш", "Зуг'гаш", "Тар'кан", "Гхор'дак", "Дуг'рул", "Крул'нах", "Шарк'зан", "Гом'раш",
        "Дак'фанг", "Нар'гул", "Скор'так", "Бур'дак", "Гхор'зул", "Мар'ток", "Гул'дан", "Гром'Рог",
        "Гро'туш", "Зуг'гаш", "Тар'кан", "Гхор'дак", "Дуг'рул", "Крул'нах", "Шарк'зан", "Гом'раш",
        "Дак'фанг", "Нар'гул", "Скор'так", "Бур'дак", "Гхор'зул", "Мар'ток", "Гул'дан", "Гром'Рог",
        "Гро'туш", "Зуг'гаш", "Тар'кан", "Гхор'дак", "Дуг'рул", "Крул'нах", "Шарк'зан", "Гом'раш",
        "Дак'фанг", "Нар'гул", "Скор'так", "Бур'дак", "Гхор'зул", "Мар'ток", "Гул'дан", "Гром'Рог",
        "Гро'туш", "Зуг'гаш", "Тар'кан", "Гхор'дак", "Дуг'рул", "Крул'нах", "Шарк'зан", "Гом'раш"
    ]
};

export const handleAdvancedNameGenerator: RequestHandler = async (req, res) => {
    try {
        const { race, class: characterClass, gender = "any", count = 1 }: NameGeneratorRequest = req.body;
        

        const names: string[] = [];

        for (let i = 0; i < count; i++) {
            const name = generateCyrillicFantasyName(race, characterClass, gender);
            names.push(name);
        }

        const response: NameGeneratorResponse = {
            names,
            success: true
        };

        res.json(response);

    } catch (error) {
        console.error('Advanced name generation error:', error);
        
        const response: NameGeneratorResponse = {
            names: [],
            success: false,
            error: error instanceof Error ? error.message : 'Unknown error'
        };
        
        res.json(response);
    }
};

function generateSurnameFromSyllables(syllables: any): string {
    const { familyPrefixes, familySuffixes, familyMiddles } = syllables;
    
    // Проверяем наличие компонентов для фамилий
    const hasFamilyPrefixes = familyPrefixes && familyPrefixes.length > 0;
    const hasFamilySuffixes = familySuffixes && familySuffixes.length > 0;
    const hasFamilyMiddles = familyMiddles && familyMiddles.length > 0;
    
    if (!hasFamilyPrefixes || !hasFamilySuffixes) {
        return ''; // Если нет основных компонентов для фамилий, возвращаем пустую строку
    }
    
    // Определяем доступные схемы генерации фамилий
    const schemes = [
        { name: 'prefix + suffix', hasMiddle: false },
        ...(hasFamilyMiddles ? [
            { name: 'prefix + middle + suffix', hasMiddle: true }
        ] : [])
    ];
    
    // Выбираем случайную схему
    const selectedScheme = schemes[Math.floor(Math.random() * schemes.length)];
    
    // Генерируем компоненты фамилии
    const prefix = familyPrefixes[Math.floor(Math.random() * familyPrefixes.length)];
    const middle = selectedScheme.hasMiddle && hasFamilyMiddles ? 
        familyMiddles[Math.floor(Math.random() * familyMiddles.length)] : '';
    const suffix = familySuffixes[Math.floor(Math.random() * familySuffixes.length)];
    
    // Собираем фамилию согласно выбранной схеме
    const surname = prefix + middle + suffix;
    
    // Применяем правила для улучшения звучания
    return applyPhoneticRules(surname);
}

function generateNameFromSyllables(syllables: any, gender: string): string {
    const { prefixes, middles, suffixes, femaleSuffixes, maleSuffixes, starters, enders } = syllables;
    
    // Определяем доступность компонентов
    const hasStarters = starters && starters.length > 0;
    const hasEnders = enders && enders.length > 0;
    const hasMiddles = middles && middles.length > 0;
    
    // Создаем массив всех возможных схем
    const schemes = [
        // Базовые схемы (всегда доступны)
        { name: 'prefix + suffix', hasStarter: false, hasMiddle: false, hasEnder: false },
        { name: 'prefix + middle + suffix', hasStarter: false, hasMiddle: true, hasEnder: false },
        
        // Схемы с enders (если доступны)
        ...(hasEnders ? [
            { name: 'prefix + suffix + ender', hasStarter: false, hasMiddle: false, hasEnder: true },
            { name: 'prefix + middle + suffix + ender', hasStarter: false, hasMiddle: true, hasEnder: true }
        ] : []),
        
        // Схемы с starters (если доступны)
        ...(hasStarters ? [
            { name: 'starter + prefix + suffix', hasStarter: true, hasMiddle: false, hasEnder: false },
            { name: 'starter + prefix + middle + suffix', hasStarter: true, hasMiddle: true, hasEnder: false },
            ...(hasEnders ? [
                { name: 'starter + prefix + suffix + ender', hasStarter: true, hasMiddle: false, hasEnder: true },
                { name: 'starter + prefix + middle + suffix + ender', hasStarter: true, hasMiddle: true, hasEnder: true }
            ] : [])
        ] : [])
    ];
    
    // Выбираем случайную схему
    const selectedScheme = schemes[Math.floor(Math.random() * schemes.length)];
    
    // Генерируем компоненты
    const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
    const middle = selectedScheme.hasMiddle && hasMiddles ? 
        middles[Math.floor(Math.random() * middles.length)] : '';
    const starter = selectedScheme.hasStarter && hasStarters ? 
        starters[Math.floor(Math.random() * starters.length)] : '';
    const ender = selectedScheme.hasEnder && hasEnders ? 
        enders[Math.floor(Math.random() * enders.length)] : '';
    
    // Выбираем суффикс в зависимости от пола
    let suffix: string;
    
    // Определяем доступность разных типов суффиксов
    const hasGeneralSuffixes = suffixes && suffixes.length > 0;
    const hasFemaleSuffixes = femaleSuffixes && femaleSuffixes.length > 0;
    const hasMaleSuffixes = maleSuffixes && maleSuffixes.length > 0;
    
    if (gender === 'female') {
        // Для женского пола: приоритет femaleSuffixes, fallback на общие suffixes
        if (hasFemaleSuffixes) {
        suffix = femaleSuffixes[Math.floor(Math.random() * femaleSuffixes.length)];
        } else if (hasGeneralSuffixes) {
            suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
        } else {
            suffix = ''; // Fallback
        }
    } else if (gender === 'male') {
        // Для мужского пола: приоритет maleSuffixes, fallback на общие suffixes
        if (hasMaleSuffixes) {
        suffix = maleSuffixes[Math.floor(Math.random() * maleSuffixes.length)];
        } else if (hasGeneralSuffixes) {
            suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
    } else {
            suffix = ''; // Fallback
        }
    } else {
        // Для случайного пола: выбираем случайно между доступными типами
        const availableTypes = [];
        if (hasGeneralSuffixes) availableTypes.push('general');
        if (hasFemaleSuffixes) availableTypes.push('female');
        if (hasMaleSuffixes) availableTypes.push('male');
        
        if (availableTypes.length === 0) {
            suffix = ''; // Fallback
        } else {
            const selectedType = availableTypes[Math.floor(Math.random() * availableTypes.length)];
            switch (selectedType) {
                case 'general':
                    suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
                    break;
                case 'female':
                    suffix = femaleSuffixes[Math.floor(Math.random() * femaleSuffixes.length)];
                    break;
                case 'male':
                    suffix = maleSuffixes[Math.floor(Math.random() * maleSuffixes.length)];
                    break;
            }
        }
    }
    
    // Собираем имя согласно выбранной схеме
    let name = '';
    if (selectedScheme.hasStarter) {
        // Апостроф добавляется только для очень длинных имен или в определенных случаях
        const fullName = starter + prefix + middle + suffix + ender;
        if (fullName.length > 8 && Math.random() < 0.3) {
            // Добавляем апостроф между starter и остальной частью для длинных имен
            name = starter + "'" + prefix + middle + suffix + ender;
        } else {
            // Для коротких имен апостроф не нужен
            name = fullName;
        }
    } else {
        name = prefix + middle + suffix + ender;
    }
    
    // Применяем правила для улучшения звучания
    name = applyPhoneticRules(name);
    
    return name;
}

function applyPhoneticRules(name: string): string {
    // Убираем повторяющиеся буквы (но сохраняем двойные согласные для эльфийских имен)
    name = name.replace(/(.)\1{2,}/g, '$1$1');
    
    // Убираем неудобные сочетания согласных (более 3 подряд)
    name = name.replace(/[бвгджзклмнпрстфхцчшщ]{4,}/g, (match) => {
        return match.substring(0, 3);
    });
    
    // Убираем неудобные сочетания гласных (более 3 подряд)
    name = name.replace(/[аеёиоуыэюя]{4,}/g, (match) => {
        return match.substring(0, 3);
    });
    
    // Улучшаем сочетания "ль", "рь" для эльфийских имен
    name = name.replace(/л{2,}/g, 'л');
    name = name.replace(/р{2,}/g, 'р');
    
    // Убираем эту логику - апострофы добавляются только в generateNameFromSyllables при необходимости
    
    // Капитализируем первую букву
    name = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
    
    // Убираем лишние апострофы в начале или конце
    name = name.replace(/^'+|'+$/g, '');
    
    return name;
}

function generateCyrillicFantasyName(race?: string, characterClass?: string, gender: string = "any"): string {
    // Определяем пол
    let actualGender = gender;
    if (gender === "any") {
        actualGender = Math.random() > 0.5 ? "male" : "female";
    }
    
    // Определяем расу
    const raceKey = race?.toLowerCase() || 'human';
    
    // Для эльфов используем генерацию по слогам с поддержкой апострофов
    if (raceKey === 'elf') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES["elf"], actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES["elf"]);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для полуэльфов используем генерацию по слогам
    if (raceKey === 'half-elf' || raceKey === 'halfelf') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES["half-elf"], actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES["half-elf"]);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для людей используем генерацию по слогам
    if (raceKey === 'human') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES.human, actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES.human);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для полуорков используем генерацию по слогам
    if (raceKey === 'half-orc' || raceKey === 'halforc') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES["half-orc"], actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES["half-orc"]);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для дварфов используем генерацию по слогам
    if (raceKey === 'dwarf') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES.dwarf, actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES.dwarf);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для гномов используем генерацию по слогам
    if (raceKey === 'gnome') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES.gnome, actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES.gnome);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для халфлингов используем генерацию по слогам
    if (raceKey === 'halfling') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES.halfling, actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES.halfling);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для драконорожденных используем генерацию по слогам
    if (raceKey === 'dragonborn') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES.dragonborn, actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES.dragonborn);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для тайфлингов используем генерацию по слогам
    if (raceKey === 'tiefling') {
        const firstName = generateNameFromSyllables(RACE_SYLLABLES.tiefling, actualGender);
        const surname = generateSurnameFromSyllables(RACE_SYLLABLES.tiefling);
        return surname ? `${firstName} ${surname}` : firstName;
    }
    
    // Для остальных рас используем старую систему
    const raceNames = CYRILLIC_FANTASY_NAMES[raceKey as keyof typeof CYRILLIC_FANTASY_NAMES];
    
    // Проверяем, есть ли у расы простая структура (не human)
    if (raceNames && 'male' in raceNames && 'female' in raceNames) {
        // Выбираем имя
        const nameList = actualGender === "male" ? raceNames.male : raceNames.female;
        const firstName = nameList[Math.floor(Math.random() * nameList.length)];
        
        // Выбираем фамилию
        const surnameList = CYRILLIC_FANTASY_SURNAMES[raceKey as keyof typeof CYRILLIC_FANTASY_SURNAMES];
        if (Array.isArray(surnameList)) {
            const surname = surnameList[Math.floor(Math.random() * surnameList.length)];
            return `${firstName} ${surname}`;
        }
    }
    
    // Fallback для остальных случаев
    return "Неизвестное Имя";
}
