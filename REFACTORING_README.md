# Рефакторинг компонента Attacks.tsx

## Обзор

Компонент `Attacks.tsx` был успешно декомпозирован для улучшения читаемости, поддерживаемости и переиспользования кода. Исходный файл содержал 7860 строк и был разделен на множество специализированных модулей.

## Структура рефакторинга

### 1. Утилитарные функции (`client/utils/`)

#### `itemUtils.ts`
- `getCleanItemName()` - очистка названий предметов
- `getItemType()` - определение типа предмета
- `getItemCategory()` - получение категории предмета
- `getItemWeight()` - получение веса предмета
- `getItemCost()` - получение стоимости предмета
- `getItemQuantity()` - получение количества предмета
- `getItemProperty()` - универсальная функция получения свойств
- `getItemStatus()` - получение статуса предмета
- `getItemSortPriority()` - приоритет сортировки
- `getMagicItemCategory()` - категория магических предметов
- `getEquippedItemCategory()` - категория экипированных предметов
- `formatCost()` - форматирование цены

#### `spellUtils.ts`
- `getAllCharacterSpells()` - все заклинания персонажа
- `getAvailableSpells()` - доступные заклинания класса
- `getAllSpells()` - все заклинания без фильтрации
- `getFilteredSpells()` - фильтрация заклинаний
- `getAvailableSpellLevels()` - доступные уровни
- `getCharacterSpellLevels()` - уровни заклинаний персонажа
- `getSpellSlotsForLevel()` - слоты для уровня
- `hasAvailableSlots()` - проверка доступности слотов
- `getMaxPreparedSpells()` - максимум подготовленных заклинаний
- `getSpellData()` - данные заклинания
- `getSpellName()` - название заклинания

#### `currencyUtils.ts`
- `convertToCopper()` - конвертация в медные монеты
- `calculateTotalGold()` - расчет общего количества в ЗМ
- `convertCurrency()` - конвертация валюты
- `calculatePurchaseCost()` - расчет стоимости покупки
- `translateCurrency()` - перевод валюты

#### `translationUtils.ts`
- `translateSave()` - перевод спасбросков
- `translateDamageType()` - перевод типов урона
- `translateWeaponType()` - перевод типов оружия
- `translateAbility()` - перевод характеристик
- `translateWeaponProperties()` - перевод свойств оружия
- `translateCurrency()` - перевод валюты

#### `equipmentUtils.ts`
- `hasMagicWeaponMastery()` - владение магическим оружием
- `getItemDetails()` - полная информация о предмете
- `getBackpackItems()` - предметы из рюкзака
- `getItemSortPriority()` - приоритет сортировки
- `canEquipItem()` - возможность экипировки
- `isVersatileWeapon()` - универсальное оружие
- `isItemEquipped()` - экипирован ли предмет

#### `weightUtils.ts`
- `calculateTotalWeight()` - общий вес
- `calculateMaxCarryWeight()` - максимальный вес
- `isOverloaded()` - проверка перегрузки

### 2. Компоненты вкладок (`client/components/tabs/`)

#### `ActionsTab.tsx`
- Отображение таблицы атак
- Управление оружием персонажа
- Расчет бонусов атаки и урона
- Обработка атак и урона

#### `SpellsTab.tsx`
- Управление слотами заклинаний
- Подготовленные заклинания
- Добавление новых заклинаний
- Фильтрация и поиск

#### `InventoryTab.tsx`
- Отображение рюкзака
- Управление предметами
- Детали предметов
- Покупка и добавление предметов

#### `FeaturesTab.tsx`
- Отображение черт персонажа
- Боевые стили
- Фильтрация и поиск
- Детали черт

### 3. Кастомные хуки (`client/hooks/`)

#### `useInventoryState.ts`
- Управление состоянием инвентаря
- Количество предметов
- Загрузка и ошибки
- Операции с предметами

#### `useSpellManagement.ts`
- Управление заклинаниями
- Состояние слотов
- Добавление/удаление заклинаний
- Фильтрация

#### `useItemManagement.ts`
- Управление предметами
- Экипировка/снятие
- Универсальное оружие
- Слоты предметов

### 4. Основной компонент

#### `AttacksRefactored.tsx`
- Упрощенная структура (150 строк вместо 7860)
- Использование декомпозированных модулей
- Четкое разделение ответственности
- Легкое тестирование и поддержка

## Преимущества рефакторинга

### 1. **Читаемость**
- Каждый файл имеет четкую ответственность
- Функции сгруппированы по назначению
- Упрощенная структура основного компонента

### 2. **Поддерживаемость**
- Изменения в одной области не влияют на другие
- Легко найти и исправить баги
- Простое добавление новых функций

### 3. **Переиспользование**
- Утилитарные функции можно использовать в других компонентах
- Хуки можно применять в разных частях приложения
- Компоненты вкладок независимы

### 4. **Тестирование**
- Каждый модуль можно тестировать отдельно
- Упрощенное создание моков
- Изолированное тестирование логики

### 5. **Производительность**
- Возможность ленивой загрузки компонентов
- Оптимизация ререндеров через хуки
- Мемоизация вычислений

## Миграция

Для использования рефакторированного компонента:

1. Замените импорт в `CharacterList.tsx`:
```typescript
// Было
import Attacks from "@/components/characterList/Attacks";

// Стало
import Attacks from "@/components/characterList/AttacksRefactored";
```

2. Убедитесь, что все зависимости установлены
3. Проверьте совместимость пропсов

## Дальнейшие улучшения

1. **Типизация** - добавление строгих типов TypeScript
2. **Тесты** - создание unit и integration тестов
3. **Оптимизация** - мемоизация и ленивая загрузка
4. **Документация** - JSDoc комментарии для всех функций
5. **Storybook** - создание историй для компонентов

## Заключение

Рефакторинг значительно улучшил архитектуру кода, сделав его более модульным, читаемым и поддерживаемым. Разделение на специализированные модули позволяет легко расширять функциональность и поддерживать код в будущем.
